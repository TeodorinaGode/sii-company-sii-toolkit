import { Component, forwardRef, Input } from '@angular/core';
import { UntypedFormControl, NG_VALIDATORS, NG_VALUE_ACCESSOR, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatAutocompleteTrigger, MatAutocomplete } from '@angular/material/autocomplete';
import { debounceTime, distinctUntilChanged, filter, map, startWith, switchMap, tap } from 'rxjs/operators';
import { MatFormField, MatLabel, MatSuffix, MatHint } from '@angular/material/form-field';
import { MatProgressBar } from '@angular/material/progress-bar';
import { MatTooltip } from '@angular/material/tooltip';
import { MatOption } from '@angular/material/core';
import { MatInput } from '@angular/material/input';
import { NgClass, AsyncPipe } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/material/dialog";
import * as i3 from "../../../sii-toolkit.service";
import * as i4 from "@angular/forms";
export class LookupOdaPosComponent {
    constructor(http, dialog, siiToolkitService) {
        this.http = http;
        this.dialog = dialog;
        this.siiToolkitService = siiToolkitService;
        this.appearance = 'legacy';
        this.disabled = false;
        this.required = false;
        this.utils = {
            odaValid: false,
            odaLength: -1,
            loadingInProgress: false,
        };
        this.selectedItem = { pos: null, oda: null };
        this.lookupOdaComponentCtrl = new UntypedFormControl();
        this.propagateChange = () => { };
        this.onTouchedCallback = () => { };
        this.validatorCallback = () => { };
        this.odaRestObs = this.lookupOdaComponentCtrl.valueChanges
            .pipe(startWith(''), debounceTime(500), tap((text) => { if (typeof text === 'string') {
            this.onChange(null);
        } }), 
        // tslint:disable-next-line:max-line-length
        map((text) => (typeof text === 'object' && (text.oda === undefined || text.oda === null)) ? '' : text), filter((text) => typeof text === 'string'), distinctUntilChanged(), tap((res) => this.utils.loadingInProgress = true), switchMap((val) => this.getOdaDataFromServer(val)), tap((res) => {
            this.utils.odaLength = res.length;
            this.utils.loadingInProgress = false;
        }));
    }
    getOdaDataFromServer(val) {
        return true ? this.useOdaDefaultRestObs(val) : null;
    }
    useOdaDefaultRestObs(txt) {
        return this.http.post(`${this.siiToolkitService.environment.domain}/lookup/oda/simple`, {
            text: txt && txt.trim().length !== 0 ? txt : null,
            codSociety: this.codSociety,
            codSupplier: this.codSupplier,
            lavMatricola: this.lavMatricola,
            tipologie: this.tipologie,
        });
    }
    displayOdaFn(oda) {
        return oda ? oda.oda : undefined;
    }
    // disabilitato, da completare su richiesta
    // searchPopup() {
    //   const dialogRef = this.dialog.open(SearchOdaPosDialogComponent, {
    //     width: '100vw',
    //     height: '95%',
    //     data: {
    //       codSociety: this.codSociety,
    //       codSupplier: this.codSupplier,
    //       lavMatricola: this.lavMatricola,
    //       tipologie: this.tipologie,
    //     },
    //   });
    //   dialogRef.afterClosed().subscribe((result: ILookupOdaDataDTO) => {
    //     if (result !== undefined) {
    //       this.onChange(result);
    //       this.lookupOdaComponentCtrl.setValue(result);
    //     }
    //   });
    // }
    onSelectionChanged(event) {
        this.onChange(event.option.value);
    }
    onChange(item) {
        this.onTouchedCallback();
        this.selectedItem.oda = item != null ? item.oda : null;
        this.selectedItem.pos = item != null ? item.pos : null;
        this.propagateChange(this.selectedItem);
    }
    validate(control) {
        const odaval = this.lookupOdaComponentCtrl.value;
        const respErr = {};
        if (odaval === null || typeof odaval === 'string') {
            if (this.required !== false) {
                respErr.odaValid = false;
                respErr.required = true;
            }
            else if ((odaval || '').trim() !== '') {
                respErr.odaValid = false;
            }
        }
        this.utils.odaValid = Object.keys(respErr).length === 0;
        return this.utils.odaValid ? null : respErr;
    }
    registerOnValidatorChange(fn) {
        this.validatorCallback = fn;
    }
    writeValue(obj) {
        this.selectedItem = obj;
        this.lookupOdaComponentCtrl.setValue(this.selectedItem);
    }
    registerOnChange(fn) { this.propagateChange = fn; }
    registerOnTouched(fn) { this.onTouchedCallback = fn; }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        if (this.disabled) {
            this.lookupOdaComponentCtrl.disable();
        }
        else {
            this.lookupOdaComponentCtrl.enable();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: LookupOdaPosComponent, deps: [{ token: i1.HttpClient }, { token: i2.MatDialog }, { token: i3.SiiToolkitService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: LookupOdaPosComponent, isStandalone: true, selector: "sii-lookup-oda-pos", inputs: { appearance: "appearance", codSociety: "codSociety", codSupplier: "codSupplier", lavMatricola: "lavMatricola", tipologie: "tipologie", disabled: "disabled", required: "required" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => LookupOdaPosComponent),
                multi: true,
            },
            { provide: NG_VALIDATORS, useExisting: LookupOdaPosComponent, multi: true },
        ], ngImport: i0, template: "<mat-form-field [appearance]=\"appearance\" class=\"lop_mff\" [ngClass]=\"{'lop_fc_invalid': !utils.odaValid}\">\r\n  <mat-label i18n=\"@@lookOdaPos__oda\" >ODA</mat-label>\r\n  <input matInput\r\n    [required]=\"required\"\r\n    aria-label=\"ODA\"\r\n    [matAutocomplete]=\"lookupOdaAutocompleteRef\"\r\n    [formControl]=\"lookupOdaComponentCtrl\"  >\r\n\r\n    <mat-autocomplete #lookupOdaAutocompleteRef=\"matAutocomplete\" class=\"lopAutoComplete\" [displayWith]=\"displayOdaFn\" (optionSelected)=\"onSelectionChanged($event)\">\r\n      @for (odaItem of odaRestObs | async; track odaItem) {\r\n        <mat-option [value]=\"odaItem\" style=\"border-bottom: 1px solid lightgray;\">\r\n          <div class=\"lopAutocompleteItems\">\r\n            <span class=\"lopAutocompleteItemsId\"> ODA/POS : <b>{{odaItem.oda}} / {{odaItem.pos}}</b></span>\r\n            <span class=\"lopAutocompleteItemsDescr\" [matTooltip]=\"odaItem.noteOda\" matTooltipShowDelay=500>{{odaItem.noteOda}}</span>\r\n            <ul class=\"lopAutocompleteListItemsDescr\">\r\n              @for (mat of odaItem.materiali; track mat) {\r\n                <li  [matTooltip]=\"mat\" matTooltipShowDelay=500>{{mat}}</li>\r\n              }\r\n            </ul>\r\n            <!-- <span class=\"lopAutocompleteItemsDescr\" [matTooltip]=\"odaItem.materiale +' - '+odaItem.descrizioneRiga\" matTooltipShowDelay=1000>{{odaItem.materiale +' - '+odaItem.descrizioneRiga}}</span>  -->\r\n          </div>\r\n        </mat-option>\r\n      }\r\n    </mat-autocomplete>\r\n\r\n    @if (selectedItem?.pos!=null) {\r\n      <div matSuffix style=\"width: 80px; \">\r\n        <div><mat-label i18n=\"@@lookOdaPos_pos\">POS</mat-label>: {{selectedItem?.pos}}</div>\r\n        <!-- disabilitato, da completare su richiesta -->\r\n        <!-- <mat-icon class=\"lopSearchIcon\" [style.visibility]=\"!(disabled!==false) ? 'initial' : 'hidden'\" style=\"cursor: pointer;\"  (click)=\"searchPopup();$event.stopPropagation();\">search</mat-icon> -->\r\n      </div>\r\n    }\r\n\r\n    @if (utils.odaLength==0) {\r\n      <mat-hint i18n=\"@@lookOdaPos_no_available_oda\">No Available Oda</mat-hint>\r\n    }\r\n  </mat-form-field>\r\n  @if (utils.loadingInProgress) {\r\n    <mat-progress-bar class=\"lopProgressBar\" mode=\"query\"></mat-progress-bar>\r\n  }\r\n", styles: [":host{position:relative}.lop_mff{width:100%}::ng-deep .lopAutoComplete .mat-mdc-option{padding:5px!important;border-bottom:1px solid lightgray;height:unset}.lopAutocompleteItems{display:flex;flex-direction:column}.lopAutocompleteListItemsDescr{padding-left:0;margin:0}.lopAutocompleteListItemsDescr>li{line-height:10px;font-size:10px;list-style-position:inside;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lopAutocompleteItems .lopAutocompleteItemsId{line-height:12px;font-size:13px}.lopAutocompleteItems .lopAutocompleteItemsDescr{line-height:10px;font-size:10px;max-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:8px}.lopProgressBar{height:2px;position:absolute;bottom:16px}.lop_mff .lop_pos_label{margin-top:-18px}.lop_mff.mat-form-field-appearance-outline .lop_pos_label{margin-top:-30px;background-color:#fff;width:40px;padding-left:6px;margin-left:-6px}.lop_fc_invalid.ng-touched::ng-deep .mdc-notched-outline>*{border-color:red!important}.lop_fc_invalid.ng-touched::ng-deep mat-label{color:red!important}.lop_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:before,.lop_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:after{border-bottom-color:red!important}.lopSearchIcon{position:absolute;top:-9px;right:0}.lop_mff.mat-form-field-appearance-outline .lopSearchIcon{top:-7px}\n"], dependencies: [{ kind: "component", type: MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: MatLabel, selector: "mat-label" }, { kind: "directive", type: MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "directive", type: MatAutocompleteTrigger, selector: "input[matAutocomplete], textarea[matAutocomplete]", inputs: ["matAutocomplete", "matAutocompletePosition", "matAutocompleteConnectedTo", "autocomplete", "matAutocompleteDisabled"], exportAs: ["matAutocompleteTrigger"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i4.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: MatAutocomplete, selector: "mat-autocomplete", inputs: ["aria-label", "aria-labelledby", "displayWith", "autoActiveFirstOption", "autoSelectActiveOption", "requireSelection", "panelWidth", "disableRipple", "class", "hideSingleSelectionIndicator"], outputs: ["optionSelected", "opened", "closed", "optionActivated"], exportAs: ["matAutocomplete"] }, { kind: "component", type: MatOption, selector: "mat-option", inputs: ["value", "id", "disabled"], outputs: ["onSelectionChange"], exportAs: ["matOption"] }, { kind: "directive", type: MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "directive", type: MatSuffix, selector: "[matSuffix], [matIconSuffix], [matTextSuffix]", inputs: ["matTextSuffix"] }, { kind: "directive", type: MatHint, selector: "mat-hint", inputs: ["align", "id"] }, { kind: "component", type: MatProgressBar, selector: "mat-progress-bar", inputs: ["color", "value", "bufferValue", "mode"], outputs: ["animationEnd"], exportAs: ["matProgressBar"] }, { kind: "pipe", type: AsyncPipe, name: "async" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: LookupOdaPosComponent, decorators: [{
            type: Component,
            args: [{ selector: 'sii-lookup-oda-pos', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => LookupOdaPosComponent),
                            multi: true,
                        },
                        { provide: NG_VALIDATORS, useExisting: LookupOdaPosComponent, multi: true },
                    ], standalone: true, imports: [
                        MatFormField,
                        NgClass,
                        MatLabel,
                        MatInput,
                        MatAutocompleteTrigger,
                        FormsModule,
                        ReactiveFormsModule,
                        MatAutocomplete,
                        MatOption,
                        MatTooltip,
                        MatSuffix,
                        MatHint,
                        MatProgressBar,
                        AsyncPipe,
                    ], template: "<mat-form-field [appearance]=\"appearance\" class=\"lop_mff\" [ngClass]=\"{'lop_fc_invalid': !utils.odaValid}\">\r\n  <mat-label i18n=\"@@lookOdaPos__oda\" >ODA</mat-label>\r\n  <input matInput\r\n    [required]=\"required\"\r\n    aria-label=\"ODA\"\r\n    [matAutocomplete]=\"lookupOdaAutocompleteRef\"\r\n    [formControl]=\"lookupOdaComponentCtrl\"  >\r\n\r\n    <mat-autocomplete #lookupOdaAutocompleteRef=\"matAutocomplete\" class=\"lopAutoComplete\" [displayWith]=\"displayOdaFn\" (optionSelected)=\"onSelectionChanged($event)\">\r\n      @for (odaItem of odaRestObs | async; track odaItem) {\r\n        <mat-option [value]=\"odaItem\" style=\"border-bottom: 1px solid lightgray;\">\r\n          <div class=\"lopAutocompleteItems\">\r\n            <span class=\"lopAutocompleteItemsId\"> ODA/POS : <b>{{odaItem.oda}} / {{odaItem.pos}}</b></span>\r\n            <span class=\"lopAutocompleteItemsDescr\" [matTooltip]=\"odaItem.noteOda\" matTooltipShowDelay=500>{{odaItem.noteOda}}</span>\r\n            <ul class=\"lopAutocompleteListItemsDescr\">\r\n              @for (mat of odaItem.materiali; track mat) {\r\n                <li  [matTooltip]=\"mat\" matTooltipShowDelay=500>{{mat}}</li>\r\n              }\r\n            </ul>\r\n            <!-- <span class=\"lopAutocompleteItemsDescr\" [matTooltip]=\"odaItem.materiale +' - '+odaItem.descrizioneRiga\" matTooltipShowDelay=1000>{{odaItem.materiale +' - '+odaItem.descrizioneRiga}}</span>  -->\r\n          </div>\r\n        </mat-option>\r\n      }\r\n    </mat-autocomplete>\r\n\r\n    @if (selectedItem?.pos!=null) {\r\n      <div matSuffix style=\"width: 80px; \">\r\n        <div><mat-label i18n=\"@@lookOdaPos_pos\">POS</mat-label>: {{selectedItem?.pos}}</div>\r\n        <!-- disabilitato, da completare su richiesta -->\r\n        <!-- <mat-icon class=\"lopSearchIcon\" [style.visibility]=\"!(disabled!==false) ? 'initial' : 'hidden'\" style=\"cursor: pointer;\"  (click)=\"searchPopup();$event.stopPropagation();\">search</mat-icon> -->\r\n      </div>\r\n    }\r\n\r\n    @if (utils.odaLength==0) {\r\n      <mat-hint i18n=\"@@lookOdaPos_no_available_oda\">No Available Oda</mat-hint>\r\n    }\r\n  </mat-form-field>\r\n  @if (utils.loadingInProgress) {\r\n    <mat-progress-bar class=\"lopProgressBar\" mode=\"query\"></mat-progress-bar>\r\n  }\r\n", styles: [":host{position:relative}.lop_mff{width:100%}::ng-deep .lopAutoComplete .mat-mdc-option{padding:5px!important;border-bottom:1px solid lightgray;height:unset}.lopAutocompleteItems{display:flex;flex-direction:column}.lopAutocompleteListItemsDescr{padding-left:0;margin:0}.lopAutocompleteListItemsDescr>li{line-height:10px;font-size:10px;list-style-position:inside;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lopAutocompleteItems .lopAutocompleteItemsId{line-height:12px;font-size:13px}.lopAutocompleteItems .lopAutocompleteItemsDescr{line-height:10px;font-size:10px;max-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:8px}.lopProgressBar{height:2px;position:absolute;bottom:16px}.lop_mff .lop_pos_label{margin-top:-18px}.lop_mff.mat-form-field-appearance-outline .lop_pos_label{margin-top:-30px;background-color:#fff;width:40px;padding-left:6px;margin-left:-6px}.lop_fc_invalid.ng-touched::ng-deep .mdc-notched-outline>*{border-color:red!important}.lop_fc_invalid.ng-touched::ng-deep mat-label{color:red!important}.lop_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:before,.lop_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:after{border-bottom-color:red!important}.lopSearchIcon{position:absolute;top:-9px;right:0}.lop_mff.mat-form-field-appearance-outline .lopSearchIcon{top:-7px}\n"] }]
        }], ctorParameters: () => [{ type: i1.HttpClient }, { type: i2.MatDialog }, { type: i3.SiiToolkitService }], propDecorators: { appearance: [{
                type: Input
            }], codSociety: [{
                type: Input
            }], codSupplier: [{
                type: Input
            }], lavMatricola: [{
                type: Input
            }], tipologie: [{
                type: Input
            }], disabled: [{
                type: Input
            }], required: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLW9kYS1wb3MuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2lpLXRvb2xraXQvc3JjL2xpYi9jb21wb25lbnRzL2RzaWktY29tcG9uZW50cy9sb29rdXAtb2RhLXBvcy9sb29rdXAtb2RhLXBvcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zaWktdG9vbGtpdC9zcmMvbGliL2NvbXBvbmVudHMvZHNpaS1jb21wb25lbnRzL2xvb2t1cC1vZGEtcG9zL2xvb2t1cC1vZGEtcG9zLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxTQUFTLEVBQWdCLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0UsT0FBTyxFQUF5QyxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQWEsV0FBVyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUssT0FBTyxFQUFnQyxzQkFBc0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUd2SCxPQUFPLEVBQUUsWUFBWSxFQUFFLG9CQUFvQixFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUs1RyxPQUFPLEVBQTBCLFlBQVksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2xILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIs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V0FBVyx1QkFBdUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO3FCQUM5RSxjQUNXLElBQUksV0FDUDt3QkFDTCxZQUFZO3dCQUNaLE9BQU87d0JBQ1AsUUFBUTt3QkFDUixRQUFRO3dCQUNSLHNCQUFzQjt3QkFDdEIsV0FBVzt3QkFDWCxtQkFBbUI7d0JBQ25CLGVBQWU7d0JBQ2YsU0FBUzt3QkFDVCxVQUFVO3dCQUNWLFNBQVM7d0JBQ1QsT0FBTzt3QkFDUCxjQUFjO3dCQUNkLFNBQVM7cUJBQ1o7dUlBR00sVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFdBQVc7c0JBQW5CLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxTQUFTO3NCQUFqQixLQUFLO2dCQUVHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBmb3J3YXJkUmVmLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBVbnR5cGVkRm9ybUNvbnRyb2wsIE5HX1ZBTElEQVRPUlMsIE5HX1ZBTFVFX0FDQ0VTU09SLCBWYWxpZGF0b3IsIEZvcm1zTW9kdWxlLCBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBNYXRBdXRvY29tcGxldGVTZWxlY3RlZEV2ZW50LCBNYXRBdXRvY29tcGxldGVUcmlnZ2VyLCBNYXRBdXRvY29tcGxldGUgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9hdXRvY29tcGxldGUnO1xyXG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZGlzdGluY3RVbnRpbENoYW5nZWQsIGZpbHRlciwgbWFwLCBzdGFydFdpdGgsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTZWFyY2hPZGFQb3NEaWFsb2dDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvc2VhcmNoLW9kYS1wb3MtZGlhbG9nL3NlYXJjaC1vZGEtcG9zLWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBJTG9va3VwT2RhRGF0YURUTyB9IGZyb20gJy4vZG9tYWluL2xvb2t1cC1vZGEtZGF0YS5kdG8nO1xyXG5pbXBvcnQgeyBJT2RhcG9zRFRPIH0gZnJvbSAnLi9kb21haW4vb2RhLXBvcy5kdG8nO1xyXG5pbXBvcnQgeyBTaWlUb29sa2l0U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NpaS10b29sa2l0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBNYXRGb3JtRmllbGRBcHBlYXJhbmNlLCBNYXRGb3JtRmllbGQsIE1hdExhYmVsLCBNYXRTdWZmaXgsIE1hdEhpbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9mb3JtLWZpZWxkJztcclxuaW1wb3J0IHsgTWF0UHJvZ3Jlc3NCYXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wcm9ncmVzcy1iYXInO1xyXG5pbXBvcnQgeyBNYXRUb29sdGlwIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvdG9vbHRpcCc7XHJcbmltcG9ydCB7IE1hdE9wdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NvcmUnO1xyXG5pbXBvcnQgeyBNYXRJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2lucHV0JztcclxuaW1wb3J0IHsgTmdDbGFzcywgQXN5bmNQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbmludGVyZmFjZSBJcmVzcG9uc2VFcnJvciB7XHJcbiAgb2RhVmFsaWQ6IGJvb2xlYW47XHJcbiAgcmVxdWlyZWQ6IGJvb2xlYW47XHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzaWktbG9va3VwLW9kYS1wb3MnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xvb2t1cC1vZGEtcG9zLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL2xvb2t1cC1vZGEtcG9zLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxyXG4gICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBMb29rdXBPZGFQb3NDb21wb25lbnQpLFxyXG4gICAgICAgICAgICBtdWx0aTogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgcHJvdmlkZTogTkdfVkFMSURBVE9SUywgdXNlRXhpc3Rpbmc6IExvb2t1cE9kYVBvc0NvbXBvbmVudCwgbXVsdGk6IHRydWUgfSxcclxuICAgIF0sXHJcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gICAgaW1wb3J0czogW1xyXG4gICAgICAgIE1hdEZvcm1GaWVsZCxcclxuICAgICAgICBOZ0NsYXNzLFxyXG4gICAgICAgIE1hdExhYmVsLFxyXG4gICAgICAgIE1hdElucHV0LFxyXG4gICAgICAgIE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIsXHJcbiAgICAgICAgRm9ybXNNb2R1bGUsXHJcbiAgICAgICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcclxuICAgICAgICBNYXRBdXRvY29tcGxldGUsXHJcbiAgICAgICAgTWF0T3B0aW9uLFxyXG4gICAgICAgIE1hdFRvb2x0aXAsXHJcbiAgICAgICAgTWF0U3VmZml4LFxyXG4gICAgICAgIE1hdEhpbnQsXHJcbiAgICAgICAgTWF0UHJvZ3Jlc3NCYXIsXHJcbiAgICAgICAgQXN5bmNQaXBlLFxyXG4gICAgXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIExvb2t1cE9kYVBvc0NvbXBvbmVudCBpbXBsZW1lbnRzIFZhbGlkYXRvciwgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xyXG4gIEBJbnB1dCgpIGFwcGVhcmFuY2UgPSAnbGVnYWN5JyBhcyBNYXRGb3JtRmllbGRBcHBlYXJhbmNlO1xyXG4gIEBJbnB1dCgpIGNvZFNvY2lldHk6IHN0cmluZztcclxuICBASW5wdXQoKSBjb2RTdXBwbGllcjogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIGxhdk1hdHJpY29sYTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHRpcG9sb2dpZTogbnVtYmVyW107XHJcblxyXG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XHJcbiAgQElucHV0KCkgcmVxdWlyZWQgPSBmYWxzZTtcclxuXHJcbiAgdXRpbHMgPSB7XHJcbiAgICBvZGFWYWxpZDogZmFsc2UsXHJcbiAgICBvZGFMZW5ndGg6IC0xLFxyXG4gICAgbG9hZGluZ0luUHJvZ3Jlc3M6IGZhbHNlLFxyXG4gIH07XHJcblxyXG4gIHNlbGVjdGVkSXRlbTogSU9kYXBvc0RUTyA9IHsgcG9zOiBudWxsLCBvZGE6IG51bGwgfTtcclxuXHJcbiAgbG9va3VwT2RhQ29tcG9uZW50Q3RybCA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2woKTtcclxuICBvZGFSZXN0T2JzOiBPYnNlcnZhYmxlPElMb29rdXBPZGFEYXRhRFRPW10+O1xyXG5cclxuICBwcm9wYWdhdGVDaGFuZ2U6IGFueSA9ICgpID0+IHsgfTtcclxuICBvblRvdWNoZWRDYWxsYmFjazogYW55ID0gKCkgPT4geyB9O1xyXG4gIHZhbGlkYXRvckNhbGxiYWNrOiBhbnkgPSAoKSA9PiB7IH07XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBodHRwOiBIdHRwQ2xpZW50LCBwdWJsaWMgZGlhbG9nOiBNYXREaWFsb2csIHB1YmxpYyBzaWlUb29sa2l0U2VydmljZTogU2lpVG9vbGtpdFNlcnZpY2UpIHtcclxuICAgIHRoaXMub2RhUmVzdE9icyA9IHRoaXMubG9va3VwT2RhQ29tcG9uZW50Q3RybC52YWx1ZUNoYW5nZXNcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgc3RhcnRXaXRoKCcnKSxcclxuICAgICAgICBkZWJvdW5jZVRpbWUoNTAwKSxcclxuICAgICAgICB0YXAoKHRleHQpID0+IHsgaWYgKHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJykgeyB0aGlzLm9uQ2hhbmdlKG51bGwpOyB9IH0pLFxyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgICAgICBtYXAoKHRleHQpID0+ICh0eXBlb2YgdGV4dCA9PT0gJ29iamVjdCcgJiYgKCh0ZXh0IGFzIElPZGFwb3NEVE8pLm9kYSA9PT0gdW5kZWZpbmVkIHx8ICh0ZXh0IGFzIElPZGFwb3NEVE8pLm9kYSA9PT0gbnVsbCkpID8gJycgOiB0ZXh0KSxcclxuICAgICAgICBmaWx0ZXIoKHRleHQpID0+IHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJyksXHJcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcclxuICAgICAgICB0YXAoKHJlcykgPT4gdGhpcy51dGlscy5sb2FkaW5nSW5Qcm9ncmVzcyA9IHRydWUpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgodmFsKSA9PiB0aGlzLmdldE9kYURhdGFGcm9tU2VydmVyKHZhbCkpLFxyXG4gICAgICAgIHRhcCgocmVzKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLnV0aWxzLm9kYUxlbmd0aCA9IHJlcy5sZW5ndGg7XHJcbiAgICAgICAgICB0aGlzLnV0aWxzLmxvYWRpbmdJblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgfSksXHJcbiAgICAgICk7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0T2RhRGF0YUZyb21TZXJ2ZXIodmFsOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0cnVlID8gdGhpcy51c2VPZGFEZWZhdWx0UmVzdE9icyh2YWwpIDogbnVsbDtcclxuICB9XHJcblxyXG4gIHVzZU9kYURlZmF1bHRSZXN0T2JzKHR4dDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8SUxvb2t1cE9kYURhdGFEVE9bXT4oYCR7dGhpcy5zaWlUb29sa2l0U2VydmljZS5lbnZpcm9ubWVudC5kb21haW59L2xvb2t1cC9vZGEvc2ltcGxlYCxcclxuICAgICAge1xyXG4gICAgICAgIHRleHQ6IHR4dCAmJiB0eHQudHJpbSgpLmxlbmd0aCAhPT0gMCA/IHR4dCA6IG51bGwsXHJcbiAgICAgICAgY29kU29jaWV0eTogdGhpcy5jb2RTb2NpZXR5LFxyXG4gICAgICAgIGNvZFN1cHBsaWVyOiB0aGlzLmNvZFN1cHBsaWVyLFxyXG4gICAgICAgIGxhdk1hdHJpY29sYTogdGhpcy5sYXZNYXRyaWNvbGEsXHJcbiAgICAgICAgdGlwb2xvZ2llOiB0aGlzLnRpcG9sb2dpZSxcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5T2RhRm4ob2RhOiBJTG9va3VwT2RhRGF0YURUTyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gb2RhID8gb2RhLm9kYSA6IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8vIGRpc2FiaWxpdGF0bywgZGEgY29tcGxldGFyZSBzdSByaWNoaWVzdGFcclxuICAvLyBzZWFyY2hQb3B1cCgpIHtcclxuICAvLyAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oU2VhcmNoT2RhUG9zRGlhbG9nQ29tcG9uZW50LCB7XHJcbiAgLy8gICAgIHdpZHRoOiAnMTAwdncnLFxyXG4gIC8vICAgICBoZWlnaHQ6ICc5NSUnLFxyXG4gIC8vICAgICBkYXRhOiB7XHJcbiAgLy8gICAgICAgY29kU29jaWV0eTogdGhpcy5jb2RTb2NpZXR5LFxyXG4gIC8vICAgICAgIGNvZFN1cHBsaWVyOiB0aGlzLmNvZFN1cHBsaWVyLFxyXG4gIC8vICAgICAgIGxhdk1hdHJpY29sYTogdGhpcy5sYXZNYXRyaWNvbGEsXHJcbiAgLy8gICAgICAgdGlwb2xvZ2llOiB0aGlzLnRpcG9sb2dpZSxcclxuICAvLyAgICAgfSxcclxuICAvLyAgIH0pO1xyXG4gIC8vICAgZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCkuc3Vic2NyaWJlKChyZXN1bHQ6IElMb29rdXBPZGFEYXRhRFRPKSA9PiB7XHJcbiAgLy8gICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gIC8vICAgICAgIHRoaXMub25DaGFuZ2UocmVzdWx0KTtcclxuICAvLyAgICAgICB0aGlzLmxvb2t1cE9kYUNvbXBvbmVudEN0cmwuc2V0VmFsdWUocmVzdWx0KTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICBvblNlbGVjdGlvbkNoYW5nZWQoZXZlbnQ6IE1hdEF1dG9jb21wbGV0ZVNlbGVjdGVkRXZlbnQpIHtcclxuICAgIHRoaXMub25DaGFuZ2UoZXZlbnQub3B0aW9uLnZhbHVlIGFzIElMb29rdXBPZGFEYXRhRFRPKTtcclxuICB9XHJcblxyXG4gIG9uQ2hhbmdlKGl0ZW06IElMb29rdXBPZGFEYXRhRFRPKSB7XHJcbiAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrKCk7XHJcbiAgICB0aGlzLnNlbGVjdGVkSXRlbS5vZGEgPSBpdGVtICE9IG51bGwgPyBpdGVtLm9kYSA6IG51bGw7XHJcbiAgICB0aGlzLnNlbGVjdGVkSXRlbS5wb3MgPSBpdGVtICE9IG51bGwgPyBpdGVtLnBvcyA6IG51bGw7XHJcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSh0aGlzLnNlbGVjdGVkSXRlbSk7XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHwgbnVsbCB7XHJcbiAgICBjb25zdCBvZGF2YWwgPSB0aGlzLmxvb2t1cE9kYUNvbXBvbmVudEN0cmwudmFsdWU7XHJcbiAgICBjb25zdCByZXNwRXJyID0ge30gYXMgSXJlc3BvbnNlRXJyb3I7XHJcbiAgICBpZiAob2RhdmFsID09PSBudWxsIHx8IHR5cGVvZiBvZGF2YWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGlmICh0aGlzLnJlcXVpcmVkICE9PSBmYWxzZSkge1xyXG4gICAgICAgIHJlc3BFcnIub2RhVmFsaWQgPSBmYWxzZTtcclxuICAgICAgICByZXNwRXJyLnJlcXVpcmVkID0gdHJ1ZTtcclxuICAgICAgfSBlbHNlIGlmICgob2RhdmFsIHx8ICcnKS50cmltKCkgIT09ICcnKSB7XHJcbiAgICAgICAgcmVzcEVyci5vZGFWYWxpZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnV0aWxzLm9kYVZhbGlkID0gT2JqZWN0LmtleXMocmVzcEVycikubGVuZ3RoID09PSAwO1xyXG4gICAgcmV0dXJuIHRoaXMudXRpbHMub2RhVmFsaWQgPyBudWxsIDogcmVzcEVycjtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25WYWxpZGF0b3JDaGFuZ2U/KGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLnZhbGlkYXRvckNhbGxiYWNrID0gZm47XHJcbiAgfVxyXG5cclxuICB3cml0ZVZhbHVlKG9iajogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IG9iaiBhcyBJT2RhcG9zRFRPO1xyXG4gICAgdGhpcy5sb29rdXBPZGFDb21wb25lbnRDdHJsLnNldFZhbHVlKHRoaXMuc2VsZWN0ZWRJdGVtKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQgeyB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuOyB9XHJcblxyXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpIHsgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuOyB9XHJcblxyXG4gIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XHJcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLmxvb2t1cE9kYUNvbXBvbmVudEN0cmwuZGlzYWJsZSgpO1xyXG4gICAgfSBlbHNlIHsgdGhpcy5sb29rdXBPZGFDb21wb25lbnRDdHJsLmVuYWJsZSgpOyB9XHJcblxyXG4gIH1cclxuXHJcbn1cclxuIiwiPG1hdC1mb3JtLWZpZWxkIFthcHBlYXJhbmNlXT1cImFwcGVhcmFuY2VcIiBjbGFzcz1cImxvcF9tZmZcIiBbbmdDbGFzc109XCJ7J2xvcF9mY19pbnZhbGlkJzogIXV0aWxzLm9kYVZhbGlkfVwiPlxyXG4gIDxtYXQtbGFiZWwgaTE4bj1cIkBAbG9va09kYVBvc19fb2RhXCIgPk9EQTwvbWF0LWxhYmVsPlxyXG4gIDxpbnB1dCBtYXRJbnB1dFxyXG4gICAgW3JlcXVpcmVkXT1cInJlcXVpcmVkXCJcclxuICAgIGFyaWEtbGFiZWw9XCJPREFcIlxyXG4gICAgW21hdEF1dG9jb21wbGV0ZV09XCJsb29rdXBPZGFBdXRvY29tcGxldGVSZWZcIlxyXG4gICAgW2Zvcm1Db250cm9sXT1cImxvb2t1cE9kYUNvbXBvbmVudEN0cmxcIiAgPlxyXG5cclxuICAgIDxtYXQtYXV0b2NvbXBsZXRlICNsb29rdXBPZGFBdXRvY29tcGxldGVSZWY9XCJtYXRBdXRvY29tcGxldGVcIiBjbGFzcz1cImxvcEF1dG9Db21wbGV0ZVwiIFtkaXNwbGF5V2l0aF09XCJkaXNwbGF5T2RhRm5cIiAob3B0aW9uU2VsZWN0ZWQpPVwib25TZWxlY3Rpb25DaGFuZ2VkKCRldmVudClcIj5cclxuICAgICAgQGZvciAob2RhSXRlbSBvZiBvZGFSZXN0T2JzIHwgYXN5bmM7IHRyYWNrIG9kYUl0ZW0pIHtcclxuICAgICAgICA8bWF0LW9wdGlvbiBbdmFsdWVdPVwib2RhSXRlbVwiIHN0eWxlPVwiYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIGxpZ2h0Z3JheTtcIj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsb3BBdXRvY29tcGxldGVJdGVtc1wiPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImxvcEF1dG9jb21wbGV0ZUl0ZW1zSWRcIj4gT0RBL1BPUyA6IDxiPnt7b2RhSXRlbS5vZGF9fSAvIHt7b2RhSXRlbS5wb3N9fTwvYj48L3NwYW4+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibG9wQXV0b2NvbXBsZXRlSXRlbXNEZXNjclwiIFttYXRUb29sdGlwXT1cIm9kYUl0ZW0ubm90ZU9kYVwiIG1hdFRvb2x0aXBTaG93RGVsYXk9NTAwPnt7b2RhSXRlbS5ub3RlT2RhfX08L3NwYW4+XHJcbiAgICAgICAgICAgIDx1bCBjbGFzcz1cImxvcEF1dG9jb21wbGV0ZUxpc3RJdGVtc0Rlc2NyXCI+XHJcbiAgICAgICAgICAgICAgQGZvciAobWF0IG9mIG9kYUl0ZW0ubWF0ZXJpYWxpOyB0cmFjayBtYXQpIHtcclxuICAgICAgICAgICAgICAgIDxsaSAgW21hdFRvb2x0aXBdPVwibWF0XCIgbWF0VG9vbHRpcFNob3dEZWxheT01MDA+e3ttYXR9fTwvbGk+XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA8L3VsPlxyXG4gICAgICAgICAgICA8IS0tIDxzcGFuIGNsYXNzPVwibG9wQXV0b2NvbXBsZXRlSXRlbXNEZXNjclwiIFttYXRUb29sdGlwXT1cIm9kYUl0ZW0ubWF0ZXJpYWxlICsnIC0gJytvZGFJdGVtLmRlc2NyaXppb25lUmlnYVwiIG1hdFRvb2x0aXBTaG93RGVsYXk9MTAwMD57e29kYUl0ZW0ubWF0ZXJpYWxlICsnIC0gJytvZGFJdGVtLmRlc2NyaXppb25lUmlnYX19PC9zcGFuPiAgLS0+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L21hdC1vcHRpb24+XHJcbiAgICAgIH1cclxuICAgIDwvbWF0LWF1dG9jb21wbGV0ZT5cclxuXHJcbiAgICBAaWYgKHNlbGVjdGVkSXRlbT8ucG9zIT1udWxsKSB7XHJcbiAgICAgIDxkaXYgbWF0U3VmZml4IHN0eWxlPVwid2lkdGg6IDgwcHg7IFwiPlxyXG4gICAgICAgIDxkaXY+PG1hdC1sYWJlbCBpMThuPVwiQEBsb29rT2RhUG9zX3Bvc1wiPlBPUzwvbWF0LWxhYmVsPjoge3tzZWxlY3RlZEl0ZW0/LnBvc319PC9kaXY+XHJcbiAgICAgICAgPCEtLSBkaXNhYmlsaXRhdG8sIGRhIGNvbXBsZXRhcmUgc3UgcmljaGllc3RhIC0tPlxyXG4gICAgICAgIDwhLS0gPG1hdC1pY29uIGNsYXNzPVwibG9wU2VhcmNoSWNvblwiIFtzdHlsZS52aXNpYmlsaXR5XT1cIiEoZGlzYWJsZWQhPT1mYWxzZSkgPyAnaW5pdGlhbCcgOiAnaGlkZGVuJ1wiIHN0eWxlPVwiY3Vyc29yOiBwb2ludGVyO1wiICAoY2xpY2spPVwic2VhcmNoUG9wdXAoKTskZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XCI+c2VhcmNoPC9tYXQtaWNvbj4gLS0+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgfVxyXG5cclxuICAgIEBpZiAodXRpbHMub2RhTGVuZ3RoPT0wKSB7XHJcbiAgICAgIDxtYXQtaGludCBpMThuPVwiQEBsb29rT2RhUG9zX25vX2F2YWlsYWJsZV9vZGFcIj5ObyBBdmFpbGFibGUgT2RhPC9tYXQtaGludD5cclxuICAgIH1cclxuICA8L21hdC1mb3JtLWZpZWxkPlxyXG4gIEBpZiAodXRpbHMubG9hZGluZ0luUHJvZ3Jlc3MpIHtcclxuICAgIDxtYXQtcHJvZ3Jlc3MtYmFyIGNsYXNzPVwibG9wUHJvZ3Jlc3NCYXJcIiBtb2RlPVwicXVlcnlcIj48L21hdC1wcm9ncmVzcy1iYXI+XHJcbiAgfVxyXG4iXX0=