import { Component, forwardRef, Input, Output, EventEmitter } from '@angular/core';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS, UntypedFormControl, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { debounceTime, distinctUntilChanged, filter, map, switchMap, tap } from 'rxjs/operators';
import { MatAutocompleteTrigger, MatAutocomplete } from '@angular/material/autocomplete';
import { MatFormField, MatLabel, MatSuffix, MatHint } from '@angular/material/form-field';
import { MatProgressBar } from '@angular/material/progress-bar';
import { MatTooltip } from '@angular/material/tooltip';
import { WorkerContactInformationComponent } from '../../worker-contact-information/worker-contact-information.component';
import { MatOption } from '@angular/material/core';
import { MatInput } from '@angular/material/input';
import { NgClass, AsyncPipe } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
export class LookupEmployeeComponent {
    constructor() {
        this.appearance = 'outline';
        this.minLength = 3;
        this.disabled = false;
        this.required = false;
        this.valueChange = new EventEmitter();
        this.hideWorkerContactInformation = false;
        this.loadOnInit = false;
        this.selectedItem = null;
        this.lookupEmployeeComponentCtrl = new UntypedFormControl();
        this.utils = {
            employeeValid: true,
            loadingInProgress: false,
        };
        this.propagateChange = () => { };
        this.onTouchedCallback = () => { };
        this.validatorCallback = () => { };
        this.employeeRestObs = this.lookupEmployeeComponentCtrl.valueChanges
            .pipe(debounceTime(500), tap((text) => { if (typeof text === 'string' && this.selectedItem != null) {
            this.onChange(null);
        } }), 
        // tslint:disable-next-line:max-line-length
        map((text) => (text == null || (typeof text === 'object' && text.workerId === undefined) ? '' : text)), filter((text) => typeof text === 'string' && text.length >= this.minLength), distinctUntilChanged(), tap((res) => this.utils.loadingInProgress = true), switchMap((val) => this.restService(val)), tap((res) => {
            this.utils.loadingInProgress = false;
        }));
    }
    ngAfterViewInit() {
        if (this.loadOnInit === true) {
            setTimeout(() => {
                this.lookupEmployeeComponentCtrl.setValue('');
            }, 1000);
        }
    }
    onSelectionChanged(event) {
        this.onChange(event.option.value);
    }
    displayEmployeeFn(employee) {
        return employee && employee.workerId !== undefined ? employee.workerId : undefined;
    }
    onChange(item) {
        this.onTouchedCallback();
        this.selectedItem = item;
        this.propagateChange(this.selectedItem);
        this.valueChange.next(this.selectedItem);
    }
    writeValue(obj) {
        this.selectedItem = obj;
        this.lookupEmployeeComponentCtrl.setValue(this.selectedItem);
    }
    registerOnChange(fn) { this.propagateChange = fn; }
    registerOnTouched(fn) { this.onTouchedCallback = fn; }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        if (this.disabled) {
            this.lookupEmployeeComponentCtrl.disable();
        }
        else {
            this.lookupEmployeeComponentCtrl.enable();
        }
    }
    validate(control) {
        const employeeval = this.lookupEmployeeComponentCtrl.value;
        const respErr = {};
        if (employeeval === null || typeof employeeval === 'string') {
            if (this.required !== false) {
                respErr.employeeValid = false;
                respErr.required = true;
            }
            else if ((employeeval || '').trim() !== '') {
                respErr.employeeValid = false;
            }
        }
        this.utils.employeeValid = Object.keys(respErr).length === 0;
        return this.utils.employeeValid ? null : respErr;
    }
    registerOnValidatorChange(fn) {
        this.validatorCallback = fn;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: LookupEmployeeComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: LookupEmployeeComponent, isStandalone: true, selector: "sii-lookup-employee", inputs: { appearance: "appearance", minLength: "minLength", label: "label", disabled: "disabled", required: "required", restService: "restService", hideWorkerContactInformation: "hideWorkerContactInformation", loadOnInit: "loadOnInit", siiWorkerContactInformationServiceUrl: "siiWorkerContactInformationServiceUrl" }, outputs: { valueChange: "valueChange" }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => LookupEmployeeComponent),
                multi: true,
            },
            { provide: NG_VALIDATORS, useExisting: LookupEmployeeComponent, multi: true },
        ], ngImport: i0, template: "<mat-form-field [appearance]=\"appearance\" class=\"lempl_mff\" [ngClass]=\"{'lempl_fc_invalid': !utils.employeeValid}\">\r\n  @if (!label) {\r\n    <mat-label i18n=\"@@lookEmployee__employee\" >Employee</mat-label>\r\n  }\r\n  @if (!!label) {\r\n    <mat-label >{{label}}</mat-label>\r\n  }\r\n  <input matInput\r\n    [required]=\"required\"\r\n    aria-label=\"Employee\"\r\n    [matAutocomplete]=\"lookupEmployeeAutocompleteRef\"\r\n    [formControl]=\"lookupEmployeeComponentCtrl\"  >\r\n\r\n    <mat-autocomplete #lookupEmployeeAutocompleteRef=\"matAutocomplete\" class=\"lemplAutoComplete\" [displayWith]=\"displayEmployeeFn\" (optionSelected)=\"onSelectionChanged($event)\">\r\n      @for (employeeItem of employeeRestObs | async; track employeeItem) {\r\n        <mat-option [value]=\"employeeItem\" style=\"border-bottom: 1px solid lightgray;min-height: 35px;\">\r\n          <div class=\"lioAutocompleteItems\">\r\n            <span class=\"lioAutocompleteItemsId\">{{employeeItem.workerId}}</span>\r\n            <span class=\"lioAutocompleteItemsDescr\">{{employeeItem.surname}} {{employeeItem.name}}</span>\r\n          </div>\r\n        </mat-option>\r\n      }\r\n    </mat-autocomplete>\r\n    @if (!hideWorkerContactInformation && selectedItem!=undefined && selectedItem.workerId!=undefined) {\r\n      <sii-worker-contact-information (click)=\"$event.stopPropagation()\" matSuffix [serviceUrl]=\"siiWorkerContactInformationServiceUrl\" [workerId]=\"selectedItem.workerId\"></sii-worker-contact-information>\r\n    }\r\n    @if (selectedItem!=undefined && selectedItem.workerId!=undefined) {\r\n      <mat-hint class=\"lioHint\" [matTooltip]=\"selectedItem.surname+' '+selectedItem.name\" >{{selectedItem.surname+' '+selectedItem.name}}</mat-hint>\r\n    }\r\n  </mat-form-field>\r\n  @if (utils.loadingInProgress) {\r\n    <mat-progress-bar class=\"lemplProgressBar\" mode=\"query\"></mat-progress-bar>\r\n  }\r\n", styles: [":host{position:relative;display:block}.lempl_mff{width:100%}::ng-deep .lemplAutoComplete .mat-mdc-option{padding:5px!important;border-bottom:1px solid lightgray;height:unset}.lemplProgressBar{height:2px;position:absolute;bottom:16px}.lempl_fc_invalid.ng-touched::ng-deep .mdc-notched-outline>*{border-color:red!important}.lempl_fc_invalid.ng-touched::ng-deep mat-label{color:red!important}.lempl_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:before,.lempl_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:after{border-bottom-color:red!important}.lemplSearchIcon{position:absolute;top:-9px;right:0}.lempl_mff.mat-form-field-appearance-outline .lemplSearchIcon{top:-7px}.lioHint{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lioAutocompleteItems{display:flex;flex-direction:column}.lioAutocompleteItems .lioAutocompleteItemsId{line-height:20px}.lioAutocompleteItems .lioAutocompleteItemsDescr{line-height:12px;font-size:10px;max-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\n"], dependencies: [{ kind: "component", type: MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: MatLabel, selector: "mat-label" }, { kind: "directive", type: MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "directive", type: MatAutocompleteTrigger, selector: "input[matAutocomplete], textarea[matAutocomplete]", inputs: ["matAutocomplete", "matAutocompletePosition", "matAutocompleteConnectedTo", "autocomplete", "matAutocompleteDisabled"], exportAs: ["matAutocompleteTrigger"] }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "component", type: MatAutocomplete, selector: "mat-autocomplete", inputs: ["aria-label", "aria-labelledby", "displayWith", "autoActiveFirstOption", "autoSelectActiveOption", "requireSelection", "panelWidth", "disableRipple", "class", "hideSingleSelectionIndicator"], outputs: ["optionSelected", "opened", "closed", "optionActivated"], exportAs: ["matAutocomplete"] }, { kind: "component", type: MatOption, selector: "mat-option", inputs: ["value", "id", "disabled"], outputs: ["onSelectionChange"], exportAs: ["matOption"] }, { kind: "component", type: WorkerContactInformationComponent, selector: "sii-worker-contact-information", inputs: ["workerId", "serviceUrl"] }, { kind: "directive", type: MatSuffix, selector: "[matSuffix], [matIconSuffix], [matTextSuffix]", inputs: ["matTextSuffix"] }, { kind: "directive", type: MatHint, selector: "mat-hint", inputs: ["align", "id"] }, { kind: "directive", type: MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "component", type: MatProgressBar, selector: "mat-progress-bar", inputs: ["color", "value", "bufferValue", "mode"], outputs: ["animationEnd"], exportAs: ["matProgressBar"] }, { kind: "pipe", type: AsyncPipe, name: "async" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: LookupEmployeeComponent, decorators: [{
            type: Component,
            args: [{ selector: 'sii-lookup-employee', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => LookupEmployeeComponent),
                            multi: true,
                        },
                        { provide: NG_VALIDATORS, useExisting: LookupEmployeeComponent, multi: true },
                    ], standalone: true, imports: [
                        MatFormField,
                        NgClass,
                        MatLabel,
                        MatInput,
                        MatAutocompleteTrigger,
                        FormsModule,
                        ReactiveFormsModule,
                        MatAutocomplete,
                        MatOption,
                        WorkerContactInformationComponent,
                        MatSuffix,
                        MatHint,
                        MatTooltip,
                        MatProgressBar,
                        AsyncPipe,
                    ], template: "<mat-form-field [appearance]=\"appearance\" class=\"lempl_mff\" [ngClass]=\"{'lempl_fc_invalid': !utils.employeeValid}\">\r\n  @if (!label) {\r\n    <mat-label i18n=\"@@lookEmployee__employee\" >Employee</mat-label>\r\n  }\r\n  @if (!!label) {\r\n    <mat-label >{{label}}</mat-label>\r\n  }\r\n  <input matInput\r\n    [required]=\"required\"\r\n    aria-label=\"Employee\"\r\n    [matAutocomplete]=\"lookupEmployeeAutocompleteRef\"\r\n    [formControl]=\"lookupEmployeeComponentCtrl\"  >\r\n\r\n    <mat-autocomplete #lookupEmployeeAutocompleteRef=\"matAutocomplete\" class=\"lemplAutoComplete\" [displayWith]=\"displayEmployeeFn\" (optionSelected)=\"onSelectionChanged($event)\">\r\n      @for (employeeItem of employeeRestObs | async; track employeeItem) {\r\n        <mat-option [value]=\"employeeItem\" style=\"border-bottom: 1px solid lightgray;min-height: 35px;\">\r\n          <div class=\"lioAutocompleteItems\">\r\n            <span class=\"lioAutocompleteItemsId\">{{employeeItem.workerId}}</span>\r\n            <span class=\"lioAutocompleteItemsDescr\">{{employeeItem.surname}} {{employeeItem.name}}</span>\r\n          </div>\r\n        </mat-option>\r\n      }\r\n    </mat-autocomplete>\r\n    @if (!hideWorkerContactInformation && selectedItem!=undefined && selectedItem.workerId!=undefined) {\r\n      <sii-worker-contact-information (click)=\"$event.stopPropagation()\" matSuffix [serviceUrl]=\"siiWorkerContactInformationServiceUrl\" [workerId]=\"selectedItem.workerId\"></sii-worker-contact-information>\r\n    }\r\n    @if (selectedItem!=undefined && selectedItem.workerId!=undefined) {\r\n      <mat-hint class=\"lioHint\" [matTooltip]=\"selectedItem.surname+' '+selectedItem.name\" >{{selectedItem.surname+' '+selectedItem.name}}</mat-hint>\r\n    }\r\n  </mat-form-field>\r\n  @if (utils.loadingInProgress) {\r\n    <mat-progress-bar class=\"lemplProgressBar\" mode=\"query\"></mat-progress-bar>\r\n  }\r\n", styles: [":host{position:relative;display:block}.lempl_mff{width:100%}::ng-deep .lemplAutoComplete .mat-mdc-option{padding:5px!important;border-bottom:1px solid lightgray;height:unset}.lemplProgressBar{height:2px;position:absolute;bottom:16px}.lempl_fc_invalid.ng-touched::ng-deep .mdc-notched-outline>*{border-color:red!important}.lempl_fc_invalid.ng-touched::ng-deep mat-label{color:red!important}.lempl_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:before,.lempl_fc_invalid.ng-touched::ng-deep .mdc-line-ripple:after{border-bottom-color:red!important}.lemplSearchIcon{position:absolute;top:-9px;right:0}.lempl_mff.mat-form-field-appearance-outline .lemplSearchIcon{top:-7px}.lioHint{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lioAutocompleteItems{display:flex;flex-direction:column}.lioAutocompleteItems .lioAutocompleteItemsId{line-height:20px}.lioAutocompleteItems .lioAutocompleteItemsDescr{line-height:12px;font-size:10px;max-height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}\n"] }]
        }], ctorParameters: () => [], propDecorators: { appearance: [{
                type: Input
            }], minLength: [{
                type: Input
            }], label: [{
                type: Input
            }], disabled: [{
                type: Input
            }], required: [{
                type: Input
            }], restService: [{
                type: Input
            }], valueChange: [{
                type: Output
            }], hideWorkerContactInformation: [{
                type: Input
            }], loadOnInit: [{
                type: Input
            }], siiWorkerContactInformationServiceUrl: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWVtcGxveWVlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NpaS10b29sa2l0L3NyYy9saWIvY29tcG9uZW50cy9kc2lpLWNvbXBvbmVudHMvbG9va3VwLWVtcGxveWVlL2xvb2t1cC1lbXBsb3llZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zaWktdG9vbGtpdC9zcmMvbGliL2NvbXBvbmVudHMvZHNpaS1jb21wb25lbnRzL2xvb2t1cC1lbXBsb3llZS9sb29rdXAtZW1wbG95ZWUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQzFHLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxhQUFhLEVBQW9ELGtCQUFrQixFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRzFLLE9BQU8sRUFBRSxZQUFZLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBYSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUcsT0FBTyxFQUFnQyxzQkFBc0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN2SCxPQUFPLEVBQTBCLFlBQVksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2xILE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sdUVBQXVFLENBQUM7QUFDMUgsT0FBTyxFQUFFLFNBQVMs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QUNmLFNBQVMscUpBQ1QsaUNBQWlDLCtHQUNqQyxTQUFTLHFIQUNULE9BQU8sOEVBQ1AsVUFBVSxpUkFDVixjQUFjLG9LQUNkLFNBQVM7OzRGQUdKLHVCQUF1QjtrQkEvQm5DLFNBQVM7K0JBQ0kscUJBQXFCLGFBR3BCO3dCQUNQOzRCQUNJLE9BQU8sRUFBRSxpQkFBaUI7NEJBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLHdCQUF3QixDQUFDOzRCQUN0RCxLQUFLLEVBQUUsSUFBSTt5QkFDZDt3QkFDRCxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsV0FBVyx5QkFBeUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO3FCQUNoRixjQUNXLElBQUksV0FDUDt3QkFDTCxZQUFZO3dCQUNaLE9BQU87d0JBQ1AsUUFBUTt3QkFDUixRQUFRO3dCQUNSLHNCQUFzQjt3QkFDdEIsV0FBVzt3QkFDWCxtQkFBbUI7d0JBQ25CLGVBQWU7d0JBQ2YsU0FBUzt3QkFDVCxpQ0FBaUM7d0JBQ2pDLFNBQVM7d0JBQ1QsT0FBTzt3QkFDUCxVQUFVO3dCQUNWLGNBQWM7d0JBQ2QsU0FBUztxQkFDWjt3REFHTSxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNJLFdBQVc7c0JBQXBCLE1BQU07Z0JBQ0UsNEJBQTRCO3NCQUFwQyxLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0cscUNBQXFDO3NCQUE3QyxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIGZvcndhcmRSZWYsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgTkdfVkFMSURBVE9SUywgVmFsaWRhdG9yLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgQWJzdHJhY3RDb250cm9sLCBVbnR5cGVkRm9ybUNvbnRyb2wsIEZvcm1zTW9kdWxlLCBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBJTG9va3VwRW1wbG95ZWVEVE8gfSBmcm9tICcuL2RvbWFpbi9sb29rdXAtZW1wbG95ZWUuZHRvJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUsIGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBmaWx0ZXIsIG1hcCwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTWF0QXV0b2NvbXBsZXRlU2VsZWN0ZWRFdmVudCwgTWF0QXV0b2NvbXBsZXRlVHJpZ2dlciwgTWF0QXV0b2NvbXBsZXRlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYXV0b2NvbXBsZXRlJztcclxuaW1wb3J0IHsgTWF0Rm9ybUZpZWxkQXBwZWFyYW5jZSwgTWF0Rm9ybUZpZWxkLCBNYXRMYWJlbCwgTWF0U3VmZml4LCBNYXRIaW50IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZm9ybS1maWVsZCc7XHJcbmltcG9ydCB7IE1hdFByb2dyZXNzQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvcHJvZ3Jlc3MtYmFyJztcclxuaW1wb3J0IHsgTWF0VG9vbHRpcCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3Rvb2x0aXAnO1xyXG5pbXBvcnQgeyBXb3JrZXJDb250YWN0SW5mb3JtYXRpb25Db21wb25lbnQgfSBmcm9tICcuLi8uLi93b3JrZXItY29udGFjdC1pbmZvcm1hdGlvbi93b3JrZXItY29udGFjdC1pbmZvcm1hdGlvbi5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBNYXRPcHRpb24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9jb3JlJztcclxuaW1wb3J0IHsgTWF0SW5wdXQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9pbnB1dCc7XHJcbmltcG9ydCB7IE5nQ2xhc3MsIEFzeW5jUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcblxyXG5pbnRlcmZhY2UgSXJlc3BvbnNlRXJyb3Ige1xyXG4gIGVtcGxveWVlVmFsaWQ6IGJvb2xlYW47XHJcbiAgcmVxdWlyZWQ6IGJvb2xlYW47XHJcbn1cclxuXHJcblxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3NpaS1sb29rdXAtZW1wbG95ZWUnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xvb2t1cC1lbXBsb3llZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9sb29rdXAtZW1wbG95ZWUuY29tcG9uZW50LnNjc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IExvb2t1cEVtcGxveWVlQ29tcG9uZW50KSxcclxuICAgICAgICAgICAgbXVsdGk6IHRydWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IHByb3ZpZGU6IE5HX1ZBTElEQVRPUlMsIHVzZUV4aXN0aW5nOiBMb29rdXBFbXBsb3llZUNvbXBvbmVudCwgbXVsdGk6IHRydWUgfSxcclxuICAgIF0sXHJcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gICAgaW1wb3J0czogW1xyXG4gICAgICAgIE1hdEZvcm1GaWVsZCxcclxuICAgICAgICBOZ0NsYXNzLFxyXG4gICAgICAgIE1hdExhYmVsLFxyXG4gICAgICAgIE1hdElucHV0LFxyXG4gICAgICAgIE1hdEF1dG9jb21wbGV0ZVRyaWdnZXIsXHJcbiAgICAgICAgRm9ybXNNb2R1bGUsXHJcbiAgICAgICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcclxuICAgICAgICBNYXRBdXRvY29tcGxldGUsXHJcbiAgICAgICAgTWF0T3B0aW9uLFxyXG4gICAgICAgIFdvcmtlckNvbnRhY3RJbmZvcm1hdGlvbkNvbXBvbmVudCxcclxuICAgICAgICBNYXRTdWZmaXgsXHJcbiAgICAgICAgTWF0SGludCxcclxuICAgICAgICBNYXRUb29sdGlwLFxyXG4gICAgICAgIE1hdFByb2dyZXNzQmFyLFxyXG4gICAgICAgIEFzeW5jUGlwZSxcclxuICAgIF0sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMb29rdXBFbXBsb3llZUNvbXBvbmVudCBpbXBsZW1lbnRzIFZhbGlkYXRvciwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIEFmdGVyVmlld0luaXQgIHtcclxuICBASW5wdXQoKSBhcHBlYXJhbmNlID0gJ291dGxpbmUnIGFzIE1hdEZvcm1GaWVsZEFwcGVhcmFuY2U7XHJcbiAgQElucHV0KCkgbWluTGVuZ3RoID0gMztcclxuICBASW5wdXQoKSBsYWJlbDtcclxuICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHJlcXVpcmVkID0gZmFsc2U7XHJcbiAgQElucHV0KCkgcmVzdFNlcnZpY2U6ICh0eHQ6IHN0cmluZykgPT4gT2JzZXJ2YWJsZTxJTG9va3VwRW1wbG95ZWVEVE9bXT47XHJcbiAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxJTG9va3VwRW1wbG95ZWVEVE8+KCk7XHJcbiAgQElucHV0KCkgaGlkZVdvcmtlckNvbnRhY3RJbmZvcm1hdGlvbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIGxvYWRPbkluaXQgPSBmYWxzZTtcclxuICBASW5wdXQoKSBzaWlXb3JrZXJDb250YWN0SW5mb3JtYXRpb25TZXJ2aWNlVXJsPzpzdHJpbmc7XHJcblxyXG4gIHNlbGVjdGVkSXRlbTogSUxvb2t1cEVtcGxveWVlRFRPID0gbnVsbDtcclxuICBsb29rdXBFbXBsb3llZUNvbXBvbmVudEN0cmwgPSBuZXcgVW50eXBlZEZvcm1Db250cm9sKCk7XHJcbiAgZW1wbG95ZWVSZXN0T2JzOiBPYnNlcnZhYmxlPElMb29rdXBFbXBsb3llZURUT1tdPjtcclxuXHJcbiAgdXRpbHMgPSB7XHJcbiAgICBlbXBsb3llZVZhbGlkOiB0cnVlLFxyXG4gICAgbG9hZGluZ0luUHJvZ3Jlc3M6IGZhbHNlLFxyXG4gIH07XHJcblxyXG4gIHByb3BhZ2F0ZUNoYW5nZTogYW55ID0gKCkgPT4geyB9O1xyXG4gIG9uVG91Y2hlZENhbGxiYWNrOiBhbnkgPSAoKSA9PiB7IH07XHJcbiAgdmFsaWRhdG9yQ2FsbGJhY2s6IGFueSA9ICgpID0+IHsgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmVtcGxveWVlUmVzdE9icyA9IHRoaXMubG9va3VwRW1wbG95ZWVDb21wb25lbnRDdHJsLnZhbHVlQ2hhbmdlc1xyXG4gICAgLnBpcGUoXHJcbiAgICAgIGRlYm91bmNlVGltZSg1MDApLFxyXG4gICAgICB0YXAoKHRleHQpID0+IHsgaWYgKHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJyAmJiB0aGlzLnNlbGVjdGVkSXRlbSAhPSBudWxsKSB7IHRoaXMub25DaGFuZ2UobnVsbCk7IH0gfSksXHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgICAgbWFwKCh0ZXh0KSA9PiAodGV4dCA9PSBudWxsIHx8ICh0eXBlb2YgdGV4dCA9PT0gJ29iamVjdCcgJiYgKHRleHQgYXMgSUxvb2t1cEVtcGxveWVlRFRPKS53b3JrZXJJZCA9PT0gdW5kZWZpbmVkKSA/ICcnIDogdGV4dCkpLFxyXG4gICAgICBmaWx0ZXIoKHRleHQpID0+IHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJyAmJiB0ZXh0Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCksXHJcbiAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXHJcbiAgICAgIHRhcCgocmVzKSA9PiB0aGlzLnV0aWxzLmxvYWRpbmdJblByb2dyZXNzID0gdHJ1ZSksXHJcbiAgICAgIHN3aXRjaE1hcCgodmFsKSA9PiB0aGlzLnJlc3RTZXJ2aWNlKHZhbCkpLFxyXG4gICAgICB0YXAoKHJlcykgPT4ge1xyXG4gICAgICAgIHRoaXMudXRpbHMubG9hZGluZ0luUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgfSksXHJcbiAgICApO1xyXG4gIH1cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5sb2FkT25Jbml0ID09PSB0cnVlKXtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb29rdXBFbXBsb3llZUNvbXBvbmVudEN0cmwuc2V0VmFsdWUoJycpO1xyXG4gICAgICB9LFxyXG4gICAgICAxMDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBvblNlbGVjdGlvbkNoYW5nZWQoZXZlbnQ6IE1hdEF1dG9jb21wbGV0ZVNlbGVjdGVkRXZlbnQpIHtcclxuICAgIHRoaXMub25DaGFuZ2UoZXZlbnQub3B0aW9uLnZhbHVlIGFzIElMb29rdXBFbXBsb3llZURUTyk7XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5RW1wbG95ZWVGbihlbXBsb3llZTogSUxvb2t1cEVtcGxveWVlRFRPKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiBlbXBsb3llZSAmJiBlbXBsb3llZS53b3JrZXJJZCAhPT0gdW5kZWZpbmVkICA/IGVtcGxveWVlLndvcmtlcklkIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcblxyXG4gIG9uQ2hhbmdlKGl0ZW06IElMb29rdXBFbXBsb3llZURUTykge1xyXG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xyXG4gICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBpdGVtO1xyXG4gICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodGhpcy5zZWxlY3RlZEl0ZW0pO1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZS5uZXh0KHRoaXMuc2VsZWN0ZWRJdGVtKTtcclxuICB9XHJcblxyXG5cclxuICB3cml0ZVZhbHVlKG9iajogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLnNlbGVjdGVkSXRlbSA9IG9iaiBhcyBJTG9va3VwRW1wbG95ZWVEVE87XHJcbiAgICB0aGlzLmxvb2t1cEVtcGxveWVlQ29tcG9uZW50Q3RybC5zZXRWYWx1ZSh0aGlzLnNlbGVjdGVkSXRlbSk7XHJcbiAgfVxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQgeyB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuOyB9XHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSkgeyB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gZm47IH1cclxuXHJcbiAgc2V0RGlzYWJsZWRTdGF0ZT8oaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XHJcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLmxvb2t1cEVtcGxveWVlQ29tcG9uZW50Q3RybC5kaXNhYmxlKCk7XHJcbiAgICB9IGVsc2UgeyB0aGlzLmxvb2t1cEVtcGxveWVlQ29tcG9uZW50Q3RybC5lbmFibGUoKTsgfVxyXG5cclxuICB9XHJcbiAgdmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB8IG51bGwge1xyXG4gICAgY29uc3QgZW1wbG95ZWV2YWwgPSB0aGlzLmxvb2t1cEVtcGxveWVlQ29tcG9uZW50Q3RybC52YWx1ZTtcclxuICAgIGNvbnN0IHJlc3BFcnIgPSB7fSBhcyBJcmVzcG9uc2VFcnJvcjtcclxuICAgIGlmIChlbXBsb3llZXZhbCA9PT0gbnVsbCB8fCB0eXBlb2YgZW1wbG95ZWV2YWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGlmICh0aGlzLnJlcXVpcmVkICE9PSBmYWxzZSkge1xyXG4gICAgICAgIHJlc3BFcnIuZW1wbG95ZWVWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIHJlc3BFcnIucmVxdWlyZWQgPSB0cnVlO1xyXG4gICAgICB9IGVsc2UgaWYgKChlbXBsb3llZXZhbCB8fCAnJykudHJpbSgpICE9PSAnJykge1xyXG4gICAgICAgIHJlc3BFcnIuZW1wbG95ZWVWYWxpZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnV0aWxzLmVtcGxveWVlVmFsaWQgPSBPYmplY3Qua2V5cyhyZXNwRXJyKS5sZW5ndGggPT09IDA7XHJcbiAgICByZXR1cm4gdGhpcy51dGlscy5lbXBsb3llZVZhbGlkID8gbnVsbCA6IHJlc3BFcnI7XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVmFsaWRhdG9yQ2hhbmdlPyhmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgdGhpcy52YWxpZGF0b3JDYWxsYmFjayA9IGZuO1xyXG4gIH1cclxuXHJcbn1cclxuIiwiPG1hdC1mb3JtLWZpZWxkIFthcHBlYXJhbmNlXT1cImFwcGVhcmFuY2VcIiBjbGFzcz1cImxlbXBsX21mZlwiIFtuZ0NsYXNzXT1cInsnbGVtcGxfZmNfaW52YWxpZCc6ICF1dGlscy5lbXBsb3llZVZhbGlkfVwiPlxyXG4gIEBpZiAoIWxhYmVsKSB7XHJcbiAgICA8bWF0LWxhYmVsIGkxOG49XCJAQGxvb2tFbXBsb3llZV9fZW1wbG95ZWVcIiA+RW1wbG95ZWU8L21hdC1sYWJlbD5cclxuICB9XHJcbiAgQGlmICghIWxhYmVsKSB7XHJcbiAgICA8bWF0LWxhYmVsID57e2xhYmVsfX08L21hdC1sYWJlbD5cclxuICB9XHJcbiAgPGlucHV0IG1hdElucHV0XHJcbiAgICBbcmVxdWlyZWRdPVwicmVxdWlyZWRcIlxyXG4gICAgYXJpYS1sYWJlbD1cIkVtcGxveWVlXCJcclxuICAgIFttYXRBdXRvY29tcGxldGVdPVwibG9va3VwRW1wbG95ZWVBdXRvY29tcGxldGVSZWZcIlxyXG4gICAgW2Zvcm1Db250cm9sXT1cImxvb2t1cEVtcGxveWVlQ29tcG9uZW50Q3RybFwiICA+XHJcblxyXG4gICAgPG1hdC1hdXRvY29tcGxldGUgI2xvb2t1cEVtcGxveWVlQXV0b2NvbXBsZXRlUmVmPVwibWF0QXV0b2NvbXBsZXRlXCIgY2xhc3M9XCJsZW1wbEF1dG9Db21wbGV0ZVwiIFtkaXNwbGF5V2l0aF09XCJkaXNwbGF5RW1wbG95ZWVGblwiIChvcHRpb25TZWxlY3RlZCk9XCJvblNlbGVjdGlvbkNoYW5nZWQoJGV2ZW50KVwiPlxyXG4gICAgICBAZm9yIChlbXBsb3llZUl0ZW0gb2YgZW1wbG95ZWVSZXN0T2JzIHwgYXN5bmM7IHRyYWNrIGVtcGxveWVlSXRlbSkge1xyXG4gICAgICAgIDxtYXQtb3B0aW9uIFt2YWx1ZV09XCJlbXBsb3llZUl0ZW1cIiBzdHlsZT1cImJvcmRlci1ib3R0b206IDFweCBzb2xpZCBsaWdodGdyYXk7bWluLWhlaWdodDogMzVweDtcIj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaW9BdXRvY29tcGxldGVJdGVtc1wiPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImxpb0F1dG9jb21wbGV0ZUl0ZW1zSWRcIj57e2VtcGxveWVlSXRlbS53b3JrZXJJZH19PC9zcGFuPlxyXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cImxpb0F1dG9jb21wbGV0ZUl0ZW1zRGVzY3JcIj57e2VtcGxveWVlSXRlbS5zdXJuYW1lfX0ge3tlbXBsb3llZUl0ZW0ubmFtZX19PC9zcGFuPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9tYXQtb3B0aW9uPlxyXG4gICAgICB9XHJcbiAgICA8L21hdC1hdXRvY29tcGxldGU+XHJcbiAgICBAaWYgKCFoaWRlV29ya2VyQ29udGFjdEluZm9ybWF0aW9uICYmIHNlbGVjdGVkSXRlbSE9dW5kZWZpbmVkICYmIHNlbGVjdGVkSXRlbS53b3JrZXJJZCE9dW5kZWZpbmVkKSB7XHJcbiAgICAgIDxzaWktd29ya2VyLWNvbnRhY3QtaW5mb3JtYXRpb24gKGNsaWNrKT1cIiRldmVudC5zdG9wUHJvcGFnYXRpb24oKVwiIG1hdFN1ZmZpeCBbc2VydmljZVVybF09XCJzaWlXb3JrZXJDb250YWN0SW5mb3JtYXRpb25TZXJ2aWNlVXJsXCIgW3dvcmtlcklkXT1cInNlbGVjdGVkSXRlbS53b3JrZXJJZFwiPjwvc2lpLXdvcmtlci1jb250YWN0LWluZm9ybWF0aW9uPlxyXG4gICAgfVxyXG4gICAgQGlmIChzZWxlY3RlZEl0ZW0hPXVuZGVmaW5lZCAmJiBzZWxlY3RlZEl0ZW0ud29ya2VySWQhPXVuZGVmaW5lZCkge1xyXG4gICAgICA8bWF0LWhpbnQgY2xhc3M9XCJsaW9IaW50XCIgW21hdFRvb2x0aXBdPVwic2VsZWN0ZWRJdGVtLnN1cm5hbWUrJyAnK3NlbGVjdGVkSXRlbS5uYW1lXCIgPnt7c2VsZWN0ZWRJdGVtLnN1cm5hbWUrJyAnK3NlbGVjdGVkSXRlbS5uYW1lfX08L21hdC1oaW50PlxyXG4gICAgfVxyXG4gIDwvbWF0LWZvcm0tZmllbGQ+XHJcbiAgQGlmICh1dGlscy5sb2FkaW5nSW5Qcm9ncmVzcykge1xyXG4gICAgPG1hdC1wcm9ncmVzcy1iYXIgY2xhc3M9XCJsZW1wbFByb2dyZXNzQmFyXCIgbW9kZT1cInF1ZXJ5XCI+PC9tYXQtcHJvZ3Jlc3MtYmFyPlxyXG4gIH1cclxuIl19