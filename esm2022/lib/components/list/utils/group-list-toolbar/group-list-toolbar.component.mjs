import { Component, Input, HostBinding } from '@angular/core';
import { BadgeComponent } from '../../../badge/badge.component';
import { MatIcon } from '@angular/material/icon';
import { MatIconButton } from '@angular/material/button';
import { MatMenu, MatMenuItem, MatMenuTrigger } from '@angular/material/menu';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
export class GroupListToolbarComponent {
    constructor(sanitizer, el) {
        this.sanitizer = sanitizer;
        this.el = el;
        this.prev = "0px";
        this.utils = {
            plt: null,
            lt: null,
        };
        window.addEventListener('listToolbarToggled', () => {
            // workaround per far rerendizzare lo sfondo al toggle
            this.el.nativeElement.style.color = 'white';
            setTimeout(() => {
                this.el.nativeElement.style.color = '';
            }, 0);
        });
    }
    ngAfterViewInit() {
        Promise.resolve().then(() => {
            if (!!this.group.parentGroupLabelTransform) {
                this.utils.plt = this.sanitizer.bypassSecurityTrustHtml(this.group.parentGroupLabelTransform(this.group.parentGroupKey, this.group.parentGroupValue, this.group.items));
            }
            if (!!this.group.groupLabelTransform) {
                this.utils.lt = this.sanitizer.bypassSecurityTrustHtml(this.group.groupLabelTransform(this.group.key, this.group.label, this.group.items));
            }
            setTimeout(() => {
                this.evaluateTop();
            }, 500);
        });
    }
    evaluateTop() {
        if (!this.group.isFirstOfparentGroup) {
            const e = this.el.nativeElement;
            if (e.parentElement == null) {
                return;
            }
            const allGroups = e.parentElement.querySelectorAll("sii-group-list-toolbar");
            let prevItem;
            for (let i = 0; i <= allGroups.length; i++) {
                if (allGroups[i].querySelectorAll(".lt_box_parent").length > 0) {
                    prevItem = allGroups[i];
                }
                if (allGroups[i] == this.el.nativeElement) {
                    break;
                }
            }
            if (prevItem != null) {
                prevItem.getElementsByClassName('lt_box_parent');
                this.prev = prevItem.getElementsByClassName('lt_box_parent')[0].getBoundingClientRect().height + "px";
            }
            else {
                this.prev = "0px";
            }
        }
    }
    toggleGroup() {
        this.ds.toggleGroup(this.group);
        this.refresh();
    }
    toggleParentGroup() {
        this.ds.toggleparentGroup(this.group.parentGroupKey);
        this.refresh();
    }
    refresh() {
        window.dispatchEvent(new CustomEvent('listToolbarToggled'));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: GroupListToolbarComponent, deps: [{ token: i1.DomSanitizer }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: GroupListToolbarComponent, isStandalone: true, selector: "sii-group-list-toolbar", inputs: { ds: "ds", group: "group" }, host: { properties: { "style.--prevGroupParent": "this.prev" } }, ngImport: i0, template: "\r\n@if (group.isFirstOfparentGroup) {\r\n  <div class=\"lt_box lt_box_parent \">\r\n    <button  class=\"expPB\" mat-icon-button  aria-label=\"expand/reduce group\" (click)=\"toggleParentGroup();\">\r\n      @switch (ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n        @case (true) {\r\n          <mat-icon>expand_more</mat-icon>\r\n        }\r\n        @case (false) {\r\n          <mat-icon>expand_less</mat-icon>\r\n        }\r\n      }\r\n    </button>\r\n    <div class=\"lt_parentlabel\">\r\n      @if (!!group.parentGroupLabelTransform) {\r\n        <div [innerHtml]=\"utils.plt\"></div>\r\n      }\r\n      @if (!group.parentGroupLabelTransform) {\r\n        <div>{{group.parentGroupValue}}</div>\r\n      }\r\n      @if (ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n        <sii-badge>{{ds.parentGroupSize(group.parentGroupKey)}}</sii-badge>\r\n      }\r\n    </div>\r\n\r\n    @if(group.parentGroupAction!=null  ){\r\n      <button class=\"actionButton\" [style.display]=\"parentMenuGroup?.items?.length>0 ? 'block':'none'\"  mat-icon-button [matMenuTriggerFor]=\"parentMenuGroup\"><mat-icon>more_vert</mat-icon></button>\r\n      <mat-menu #parentMenuGroup=\"matMenu\">\r\n        @for (mi of  group.parentGroupAction; track mi) {\r\n          @if(  mi.visible==null || mi.visible(group.parentGroupKey,group.parentGroupValue,group.items)){\r\n            <button   mat-menu-item (click)=\"mi.action(group.parentGroupKey,group.parentGroupValue,group.items)\"><mat-icon>{{mi.icon}}</mat-icon>{{mi.label}}</button>\r\n          }\r\n        }\r\n      </mat-menu> \r\n    }\r\n  </div>\r\n}\r\n\r\n\r\n\r\n\r\n@if (!ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n  <div class=\"lt_box\">\r\n    <button class=\"expB\" (click)=\"toggleGroup();\"   mat-icon-button   aria-label=\"expand/reduce group\">\r\n      @switch (ds.isGroupCollapsed(group.key)) {\r\n        @case (true) {\r\n          <mat-icon>expand_more</mat-icon>\r\n        }\r\n        @case (false) {\r\n          <mat-icon>expand_less</mat-icon>\r\n        }\r\n      }\r\n    </button>\r\n    <div class=\"lt_label\">\r\n      @if (!!group.groupLabelTransform) {\r\n        <div  [innerHtml]=\"utils.lt\"></div>\r\n      }\r\n      @if (!group.groupLabelTransform) {\r\n        <div>{{group.label}}</div>\r\n      }\r\n      @if (ds.isGroupCollapsed(group.key)) {\r\n        <sii-badge>{{group.items.length}}</sii-badge>\r\n      }\r\n    </div>\r\n\r\n    @if(group.groupAction!=null  ){\r\n      <button class=\"actionButton\"   [style.display]=\"menuGroup?.items?.length>0 ? 'block':'none'\" mat-icon-button [matMenuTriggerFor]=\"menuGroup\"><mat-icon>more_vert</mat-icon></button>\r\n      <mat-menu #menuGroup=\"matMenu\">\r\n        @for (mi of  group.groupAction; track mi) {\r\n          @if(mi.visible==null || mi.visible(group.key,group.label,group.items)){\r\n          <button mat-menu-item  (click)=\"mi.action(group.key,group.label,group.items)\"><mat-icon>{{mi.icon}}</mat-icon>{{mi.label}}</button>\r\n       }\r\n      }\r\n      </mat-menu> \r\n    }\r\n\r\n  </div>\r\n}\r\n\r\n", styles: [":host{display:flex;flex-direction:column;width:100%}:host.refresh{background-color:red}.lt_box{display:flex;width:100%;color:#ffffffc7;align-items:center}.lt_label{flex:1;margin:auto;padding-left:10px;font-size:18px;letter-spacing:.84px;font-family:neue-haas-grotesk-display,Roboto,Helvetica Neue,\"sans-serif\";line-height:20px;display:flex;align-items:center}.lt_parentlabel{flex:1;margin:auto;padding-left:10px;font-size:28px;letter-spacing:.84px;font-family:neue-haas-grotesk-display,Roboto,Helvetica Neue,\"sans-serif\";line-height:30px;display:flex;align-items:center}.lt_parentlabel>div,.lt_label>div{max-width:100%;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden}sii-badge{font-size:16px;background-color:#04202e8f;margin-left:10px}.expB,.expPB{transform:scale(.8)}.expB mat-icon,.expPB mat-icon{transform:scale(2);display:block}@media screen and (max-width: 992px){.lt_label{font-size:16px;line-height:18px}.lt_parentlabel{font-size:18px;line-height:20px}}sii-badge{padding:1px 12px}\n"], dependencies: [{ kind: "component", type: MatIconButton, selector: "button[mat-icon-button]", exportAs: ["matButton"] }, { kind: "component", type: MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: BadgeComponent, selector: "sii-badge", inputs: ["appearance", "background", "color"] }, { kind: "component", type: MatMenu, selector: "mat-menu", inputs: ["backdropClass", "aria-label", "aria-labelledby", "aria-describedby", "xPosition", "yPosition", "overlapTrigger", "hasBackdrop", "class", "classList"], outputs: ["closed", "close"], exportAs: ["matMenu"] }, { kind: "directive", type: MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", inputs: ["mat-menu-trigger-for", "matMenuTriggerFor", "matMenuTriggerData", "matMenuTriggerRestoreFocus"], outputs: ["menuOpened", "onMenuOpen", "menuClosed", "onMenuClose"], exportAs: ["matMenuTrigger"] }, { kind: "component", type: MatMenuItem, selector: "[mat-menu-item]", inputs: ["role", "disabled", "disableRipple"], exportAs: ["matMenuItem"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: GroupListToolbarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'sii-group-list-toolbar', standalone: true, imports: [MatIconButton, MatIcon, BadgeComponent, MatMenu, MatMenuTrigger, MatMenuItem], template: "\r\n@if (group.isFirstOfparentGroup) {\r\n  <div class=\"lt_box lt_box_parent \">\r\n    <button  class=\"expPB\" mat-icon-button  aria-label=\"expand/reduce group\" (click)=\"toggleParentGroup();\">\r\n      @switch (ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n        @case (true) {\r\n          <mat-icon>expand_more</mat-icon>\r\n        }\r\n        @case (false) {\r\n          <mat-icon>expand_less</mat-icon>\r\n        }\r\n      }\r\n    </button>\r\n    <div class=\"lt_parentlabel\">\r\n      @if (!!group.parentGroupLabelTransform) {\r\n        <div [innerHtml]=\"utils.plt\"></div>\r\n      }\r\n      @if (!group.parentGroupLabelTransform) {\r\n        <div>{{group.parentGroupValue}}</div>\r\n      }\r\n      @if (ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n        <sii-badge>{{ds.parentGroupSize(group.parentGroupKey)}}</sii-badge>\r\n      }\r\n    </div>\r\n\r\n    @if(group.parentGroupAction!=null  ){\r\n      <button class=\"actionButton\" [style.display]=\"parentMenuGroup?.items?.length>0 ? 'block':'none'\"  mat-icon-button [matMenuTriggerFor]=\"parentMenuGroup\"><mat-icon>more_vert</mat-icon></button>\r\n      <mat-menu #parentMenuGroup=\"matMenu\">\r\n        @for (mi of  group.parentGroupAction; track mi) {\r\n          @if(  mi.visible==null || mi.visible(group.parentGroupKey,group.parentGroupValue,group.items)){\r\n            <button   mat-menu-item (click)=\"mi.action(group.parentGroupKey,group.parentGroupValue,group.items)\"><mat-icon>{{mi.icon}}</mat-icon>{{mi.label}}</button>\r\n          }\r\n        }\r\n      </mat-menu> \r\n    }\r\n  </div>\r\n}\r\n\r\n\r\n\r\n\r\n@if (!ds.isParentGroupCollapsed(group.parentGroupKey)) {\r\n  <div class=\"lt_box\">\r\n    <button class=\"expB\" (click)=\"toggleGroup();\"   mat-icon-button   aria-label=\"expand/reduce group\">\r\n      @switch (ds.isGroupCollapsed(group.key)) {\r\n        @case (true) {\r\n          <mat-icon>expand_more</mat-icon>\r\n        }\r\n        @case (false) {\r\n          <mat-icon>expand_less</mat-icon>\r\n        }\r\n      }\r\n    </button>\r\n    <div class=\"lt_label\">\r\n      @if (!!group.groupLabelTransform) {\r\n        <div  [innerHtml]=\"utils.lt\"></div>\r\n      }\r\n      @if (!group.groupLabelTransform) {\r\n        <div>{{group.label}}</div>\r\n      }\r\n      @if (ds.isGroupCollapsed(group.key)) {\r\n        <sii-badge>{{group.items.length}}</sii-badge>\r\n      }\r\n    </div>\r\n\r\n    @if(group.groupAction!=null  ){\r\n      <button class=\"actionButton\"   [style.display]=\"menuGroup?.items?.length>0 ? 'block':'none'\" mat-icon-button [matMenuTriggerFor]=\"menuGroup\"><mat-icon>more_vert</mat-icon></button>\r\n      <mat-menu #menuGroup=\"matMenu\">\r\n        @for (mi of  group.groupAction; track mi) {\r\n          @if(mi.visible==null || mi.visible(group.key,group.label,group.items)){\r\n          <button mat-menu-item  (click)=\"mi.action(group.key,group.label,group.items)\"><mat-icon>{{mi.icon}}</mat-icon>{{mi.label}}</button>\r\n       }\r\n      }\r\n      </mat-menu> \r\n    }\r\n\r\n  </div>\r\n}\r\n\r\n", styles: [":host{display:flex;flex-direction:column;width:100%}:host.refresh{background-color:red}.lt_box{display:flex;width:100%;color:#ffffffc7;align-items:center}.lt_label{flex:1;margin:auto;padding-left:10px;font-size:18px;letter-spacing:.84px;font-family:neue-haas-grotesk-display,Roboto,Helvetica Neue,\"sans-serif\";line-height:20px;display:flex;align-items:center}.lt_parentlabel{flex:1;margin:auto;padding-left:10px;font-size:28px;letter-spacing:.84px;font-family:neue-haas-grotesk-display,Roboto,Helvetica Neue,\"sans-serif\";line-height:30px;display:flex;align-items:center}.lt_parentlabel>div,.lt_label>div{max-width:100%;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden}sii-badge{font-size:16px;background-color:#04202e8f;margin-left:10px}.expB,.expPB{transform:scale(.8)}.expB mat-icon,.expPB mat-icon{transform:scale(2);display:block}@media screen and (max-width: 992px){.lt_label{font-size:16px;line-height:18px}.lt_parentlabel{font-size:18px;line-height:20px}}sii-badge{padding:1px 12px}\n"] }]
        }], ctorParameters: () => [{ type: i1.DomSanitizer }, { type: i0.ElementRef }], propDecorators: { ds: [{
                type: Input
            }], group: [{
                type: Input
            }], prev: [{
                type: HostBinding,
                args: ['style.--prevGroupParent']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAtbGlzdC10b29sYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NpaS10b29sa2l0L3NyYy9saWIvY29tcG9uZW50cy9saXN0L3V0aWxzL2dyb3VwLWxpc3QtdG9vbGJhci9ncm91cC1saXN0LXRvb2xiYXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2lpLXRvb2xraXQvc3JjL2xpYi9jb21wb25lbnRzL2xpc3QvdXRpbHMvZ3JvdXAtbGlzdC10b29sYmFyL2dyb3VwLWxpc3QtdG9vbGJhci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBNkIsV0FBVyxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBR3BHLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDakQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7QUFTOUUsTUFBTSxPQUFPLHlCQUF5QjtJQWVwQyxZQUFxQixTQUF1QixFQUFVLEVBQWM7UUFBL0MsY0FBUyxHQUFULFNBQVMsQ0FBYztRQUFVLE9BQUUsR0FBRixFQUFFLENBQVk7UUFaM0IsU0FBSSxHQUFDLEtBQUssQ0FBQztRQVFwRCxVQUFLLEdBQUc7WUFDTixHQUFHLEVBQUUsSUFBSTtZQUNULEVBQUUsRUFBRSxJQUFJO1NBQ1QsQ0FBQztRQUVBLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7WUFDakQsc0RBQXNEO1lBQ3RELElBQUksQ0FBQyxFQUFFLENBQUMs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SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBRUQsaUJBQWlCO1FBQ2YsSUFBSSxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBRUQsT0FBTztRQUNMLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxXQUFXLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0lBQzlELENBQUM7K0dBckZVLHlCQUF5QjttR0FBekIseUJBQXlCLDBMQ2Z0Qyw0aEdBK0VBLGlrQ0RsRWMsYUFBYSw2RkFBRSxPQUFPLDJJQUFFLGNBQWMscUdBQUUsT0FBTywyUUFBRSxjQUFjLHFTQUFFLFdBQVc7OzRGQUU3RSx5QkFBeUI7a0JBUHJDLFNBQVM7K0JBQ0ksd0JBQXdCLGNBR3RCLElBQUksV0FDUCxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsV0FBVyxDQUFDOzBHQUdoRixFQUFFO3NCQUFWLEtBQUs7Z0JBQ0csS0FBSztzQkFBYixLQUFLO2dCQUNtQyxJQUFJO3NCQUE1QyxXQUFXO3VCQUFDLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIEFmdGVyVmlld0luaXQsIEVsZW1lbnRSZWYsIEhvc3RCaW5kaW5nLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XHJcbmltcG9ydCB7IENpc0dyb3VwLCBTaWlHcm91cGVkSW5maW5pdGVTY3JvbGxEYXRhU291cmNlIH0gZnJvbSAnLi4vLi4vZ3JvdXBlZC1pbmZpbml0ZS1zY3JvbGwvdXRpbHMvc2lpLWdyb3VwZWQtaW5maW5pdGUtc2Nyb2xsLWRhdGEtc291cmNlJztcclxuaW1wb3J0IHsgQmFkZ2VDb21wb25lbnQgfSBmcm9tICcuLi8uLi8uLi9iYWRnZS9iYWRnZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBNYXRJY29uIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvaWNvbic7XHJcbmltcG9ydCB7IE1hdEljb25CdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xyXG5pbXBvcnQgeyBNYXRNZW51LCBNYXRNZW51SXRlbSwgTWF0TWVudVRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9tZW51JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdzaWktZ3JvdXAtbGlzdC10b29sYmFyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi9ncm91cC1saXN0LXRvb2xiYXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vZ3JvdXAtbGlzdC10b29sYmFyLmNvbXBvbmVudC5zY3NzJ10sXHJcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gICAgaW1wb3J0czogW01hdEljb25CdXR0b24sIE1hdEljb24sIEJhZGdlQ29tcG9uZW50LCBNYXRNZW51LCBNYXRNZW51VHJpZ2dlciwgTWF0TWVudUl0ZW1dXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBHcm91cExpc3RUb29sYmFyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQElucHV0KCkgZHM6ICBTaWlHcm91cGVkSW5maW5pdGVTY3JvbGxEYXRhU291cmNlO1xyXG4gIEBJbnB1dCgpIGdyb3VwOiBDaXNHcm91cDtcclxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLi0tcHJldkdyb3VwUGFyZW50JykgIHByZXY9XCIwcHhcIjtcclxuIFxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gIHV0aWxzID0ge1xyXG4gICAgcGx0OiBudWxsLFxyXG4gICAgbHQ6IG51bGwsXHJcbiAgfTtcclxuICBjb25zdHJ1Y3RvciggcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplciwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZiApIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsaXN0VG9vbGJhclRvZ2dsZWQnLCAoKSA9PiB7XHJcbiAgICAgIC8vIHdvcmthcm91bmQgcGVyIGZhciByZXJlbmRpenphcmUgbG8gc2ZvbmRvIGFsIHRvZ2dsZVxyXG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUuY29sb3IgPSAnd2hpdGUnO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUuY29sb3IgPSAnJztcclxuICAgICAgfSwgMCk7XHJcbiAgICB9KTtcclxuICAgfVxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICBpZiAoISF0aGlzLmdyb3VwLnBhcmVudEdyb3VwTGFiZWxUcmFuc2Zvcm0pe1xyXG4gICAgICAgIHRoaXMudXRpbHMucGx0ID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwodGhpcy5ncm91cC5wYXJlbnRHcm91cExhYmVsVHJhbnNmb3JtKHRoaXMuZ3JvdXAucGFyZW50R3JvdXBLZXksIHRoaXMuZ3JvdXAucGFyZW50R3JvdXBWYWx1ZSwgdGhpcy5ncm91cC5pdGVtcykpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghIXRoaXMuZ3JvdXAuZ3JvdXBMYWJlbFRyYW5zZm9ybSl7XHJcbiAgICAgICAgdGhpcy51dGlscy5sdCA9IHRoaXMuc2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKHRoaXMuZ3JvdXAuZ3JvdXBMYWJlbFRyYW5zZm9ybSh0aGlzLmdyb3VwLmtleSwgdGhpcy5ncm91cC5sYWJlbCwgdGhpcy5ncm91cC5pdGVtcykpO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgICAgc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICAgIHRoaXMuZXZhbHVhdGVUb3AoKVxyXG4gICAgICB9LDUwMClcclxuXHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBldmFsdWF0ZVRvcCgpe1xyXG5cclxuICAgIGlmKCF0aGlzLmdyb3VwLmlzRmlyc3RPZnBhcmVudEdyb3VwICApe1xyXG4gICAgICBjb25zdCBlPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnRcclxuXHJcbiAgICAgIGlmKGUucGFyZW50RWxlbWVudD09bnVsbCl7XHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGFsbEdyb3Vwcz0gZS5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJzaWktZ3JvdXAtbGlzdC10b29sYmFyXCIpXHJcbiAgICAgIGxldCBwcmV2SXRlbTtcclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDw9IGFsbEdyb3Vwcy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBpZihhbGxHcm91cHNbIGkgXS5xdWVyeVNlbGVjdG9yQWxsKFwiLmx0X2JveF9wYXJlbnRcIikubGVuZ3RoPjApe1xyXG4gICAgICAgICAgcHJldkl0ZW09YWxsR3JvdXBzWyBpIF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhbGxHcm91cHNbIGkgXT09IHRoaXMuZWwubmF0aXZlRWxlbWVudCApIHtcclxuICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgICAgfVxyXG5cclxuICAgICAgIGlmKHByZXZJdGVtIT1udWxsKXtcclxuICAgICAgICAgIHByZXZJdGVtLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2x0X2JveF9wYXJlbnQnKVxyXG4gICAgICAgICAgdGhpcy5wcmV2PSBwcmV2SXRlbS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdsdF9ib3hfcGFyZW50JylbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0K1wicHhcIjtcclxuICAgICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMucHJldj1cIjBweFwiO1xyXG4gICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB0b2dnbGVHcm91cCgpe1xyXG4gICAgdGhpcy5kcy50b2dnbGVHcm91cCh0aGlzLmdyb3VwKTtcclxuICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gIH1cclxuXHJcbiAgdG9nZ2xlUGFyZW50R3JvdXAoKXtcclxuICAgIHRoaXMuZHMudG9nZ2xlcGFyZW50R3JvdXAodGhpcy5ncm91cC5wYXJlbnRHcm91cEtleSk7XHJcbiAgICB0aGlzLnJlZnJlc2goKTtcclxuICB9XHJcblxyXG4gIHJlZnJlc2goKXtcclxuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnbGlzdFRvb2xiYXJUb2dnbGVkJykpO1xyXG4gIH1cclxuXHJcbn1cclxuIiwiXHJcbkBpZiAoZ3JvdXAuaXNGaXJzdE9mcGFyZW50R3JvdXApIHtcclxuICA8ZGl2IGNsYXNzPVwibHRfYm94IGx0X2JveF9wYXJlbnQgXCI+XHJcbiAgICA8YnV0dG9uICBjbGFzcz1cImV4cFBCXCIgbWF0LWljb24tYnV0dG9uICBhcmlhLWxhYmVsPVwiZXhwYW5kL3JlZHVjZSBncm91cFwiIChjbGljayk9XCJ0b2dnbGVQYXJlbnRHcm91cCgpO1wiPlxyXG4gICAgICBAc3dpdGNoIChkcy5pc1BhcmVudEdyb3VwQ29sbGFwc2VkKGdyb3VwLnBhcmVudEdyb3VwS2V5KSkge1xyXG4gICAgICAgIEBjYXNlICh0cnVlKSB7XHJcbiAgICAgICAgICA8bWF0LWljb24+ZXhwYW5kX21vcmU8L21hdC1pY29uPlxyXG4gICAgICAgIH1cclxuICAgICAgICBAY2FzZSAoZmFsc2UpIHtcclxuICAgICAgICAgIDxtYXQtaWNvbj5leHBhbmRfbGVzczwvbWF0LWljb24+XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICA8L2J1dHRvbj5cclxuICAgIDxkaXYgY2xhc3M9XCJsdF9wYXJlbnRsYWJlbFwiPlxyXG4gICAgICBAaWYgKCEhZ3JvdXAucGFyZW50R3JvdXBMYWJlbFRyYW5zZm9ybSkge1xyXG4gICAgICAgIDxkaXYgW2lubmVySHRtbF09XCJ1dGlscy5wbHRcIj48L2Rpdj5cclxuICAgICAgfVxyXG4gICAgICBAaWYgKCFncm91cC5wYXJlbnRHcm91cExhYmVsVHJhbnNmb3JtKSB7XHJcbiAgICAgICAgPGRpdj57e2dyb3VwLnBhcmVudEdyb3VwVmFsdWV9fTwvZGl2PlxyXG4gICAgICB9XHJcbiAgICAgIEBpZiAoZHMuaXNQYXJlbnRHcm91cENvbGxhcHNlZChncm91cC5wYXJlbnRHcm91cEtleSkpIHtcclxuICAgICAgICA8c2lpLWJhZGdlPnt7ZHMucGFyZW50R3JvdXBTaXplKGdyb3VwLnBhcmVudEdyb3VwS2V5KX19PC9zaWktYmFkZ2U+XHJcbiAgICAgIH1cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIEBpZihncm91cC5wYXJlbnRHcm91cEFjdGlvbiE9bnVsbCAgKXtcclxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImFjdGlvbkJ1dHRvblwiIFtzdHlsZS5kaXNwbGF5XT1cInBhcmVudE1lbnVHcm91cD8uaXRlbXM/Lmxlbmd0aD4wID8gJ2Jsb2NrJzonbm9uZSdcIiAgbWF0LWljb24tYnV0dG9uIFttYXRNZW51VHJpZ2dlckZvcl09XCJwYXJlbnRNZW51R3JvdXBcIj48bWF0LWljb24+bW9yZV92ZXJ0PC9tYXQtaWNvbj48L2J1dHRvbj5cclxuICAgICAgPG1hdC1tZW51ICNwYXJlbnRNZW51R3JvdXA9XCJtYXRNZW51XCI+XHJcbiAgICAgICAgQGZvciAobWkgb2YgIGdyb3VwLnBhcmVudEdyb3VwQWN0aW9uOyB0cmFjayBtaSkge1xyXG4gICAgICAgICAgQGlmKCAgbWkudmlzaWJsZT09bnVsbCB8fCBtaS52aXNpYmxlKGdyb3VwLnBhcmVudEdyb3VwS2V5LGdyb3VwLnBhcmVudEdyb3VwVmFsdWUsZ3JvdXAuaXRlbXMpKXtcclxuICAgICAgICAgICAgPGJ1dHRvbiAgIG1hdC1tZW51LWl0ZW0gKGNsaWNrKT1cIm1pLmFjdGlvbihncm91cC5wYXJlbnRHcm91cEtleSxncm91cC5wYXJlbnRHcm91cFZhbHVlLGdyb3VwLml0ZW1zKVwiPjxtYXQtaWNvbj57e21pLmljb259fTwvbWF0LWljb24+e3ttaS5sYWJlbH19PC9idXR0b24+XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICA8L21hdC1tZW51PiBcclxuICAgIH1cclxuICA8L2Rpdj5cclxufVxyXG5cclxuXHJcblxyXG5cclxuQGlmICghZHMuaXNQYXJlbnRHcm91cENvbGxhcHNlZChncm91cC5wYXJlbnRHcm91cEtleSkpIHtcclxuICA8ZGl2IGNsYXNzPVwibHRfYm94XCI+XHJcbiAgICA8YnV0dG9uIGNsYXNzPVwiZXhwQlwiIChjbGljayk9XCJ0b2dnbGVHcm91cCgpO1wiICAgbWF0LWljb24tYnV0dG9uICAgYXJpYS1sYWJlbD1cImV4cGFuZC9yZWR1Y2UgZ3JvdXBcIj5cclxuICAgICAgQHN3aXRjaCAoZHMuaXNHcm91cENvbGxhcHNlZChncm91cC5rZXkpKSB7XHJcbiAgICAgICAgQGNhc2UgKHRydWUpIHtcclxuICAgICAgICAgIDxtYXQtaWNvbj5leHBhbmRfbW9yZTwvbWF0LWljb24+XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEBjYXNlIChmYWxzZSkge1xyXG4gICAgICAgICAgPG1hdC1pY29uPmV4cGFuZF9sZXNzPC9tYXQtaWNvbj5cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIDwvYnV0dG9uPlxyXG4gICAgPGRpdiBjbGFzcz1cImx0X2xhYmVsXCI+XHJcbiAgICAgIEBpZiAoISFncm91cC5ncm91cExhYmVsVHJhbnNmb3JtKSB7XHJcbiAgICAgICAgPGRpdiAgW2lubmVySHRtbF09XCJ1dGlscy5sdFwiPjwvZGl2PlxyXG4gICAgICB9XHJcbiAgICAgIEBpZiAoIWdyb3VwLmdyb3VwTGFiZWxUcmFuc2Zvcm0pIHtcclxuICAgICAgICA8ZGl2Pnt7Z3JvdXAubGFiZWx9fTwvZGl2PlxyXG4gICAgICB9XHJcbiAgICAgIEBpZiAoZHMuaXNHcm91cENvbGxhcHNlZChncm91cC5rZXkpKSB7XHJcbiAgICAgICAgPHNpaS1iYWRnZT57e2dyb3VwLml0ZW1zLmxlbmd0aH19PC9zaWktYmFkZ2U+XHJcbiAgICAgIH1cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIEBpZihncm91cC5ncm91cEFjdGlvbiE9bnVsbCAgKXtcclxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImFjdGlvbkJ1dHRvblwiICAgW3N0eWxlLmRpc3BsYXldPVwibWVudUdyb3VwPy5pdGVtcz8ubGVuZ3RoPjAgPyAnYmxvY2snOidub25lJ1wiIG1hdC1pY29uLWJ1dHRvbiBbbWF0TWVudVRyaWdnZXJGb3JdPVwibWVudUdyb3VwXCI+PG1hdC1pY29uPm1vcmVfdmVydDwvbWF0LWljb24+PC9idXR0b24+XHJcbiAgICAgIDxtYXQtbWVudSAjbWVudUdyb3VwPVwibWF0TWVudVwiPlxyXG4gICAgICAgIEBmb3IgKG1pIG9mICBncm91cC5ncm91cEFjdGlvbjsgdHJhY2sgbWkpIHtcclxuICAgICAgICAgIEBpZihtaS52aXNpYmxlPT1udWxsIHx8IG1pLnZpc2libGUoZ3JvdXAua2V5LGdyb3VwLmxhYmVsLGdyb3VwLml0ZW1zKSl7XHJcbiAgICAgICAgICA8YnV0dG9uIG1hdC1tZW51LWl0ZW0gIChjbGljayk9XCJtaS5hY3Rpb24oZ3JvdXAua2V5LGdyb3VwLmxhYmVsLGdyb3VwLml0ZW1zKVwiPjxtYXQtaWNvbj57e21pLmljb259fTwvbWF0LWljb24+e3ttaS5sYWJlbH19PC9idXR0b24+XHJcbiAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgPC9tYXQtbWVudT4gXHJcbiAgICB9XHJcblxyXG4gIDwvZGl2PlxyXG59XHJcblxyXG4iXX0=