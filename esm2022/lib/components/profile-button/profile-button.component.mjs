import { Component, Input } from '@angular/core';
import { MatIcon } from '@angular/material/icon';
import { NgStyle } from '@angular/common';
import { MatMiniFabButton } from '@angular/material/button';
import * as i0 from "@angular/core";
import * as i1 from "../../sii-toolkit.service";
import * as i2 from "../dsii-components/delegation/delegation.service";
import * as i3 from "@angular/router";
import * as i4 from "../dsii-components/sdac-preview/service/sdac-preview.service";
import * as i5 from "../../service/sii-engage.service";
export class ProfileButtonComponent {
    get sdacTicketCount() {
        return this.sdacPreviewService.ticketCount;
    }
    get sdacNotificationCount() {
        return this.sdacPreviewService.notificationCount;
    }
    get corporateItCalendarEventsCount() {
        return this.engageService.corporateCalendarEventsCount;
    }
    constructor(siiToolkitService, delegationService, router, sdacPreviewService, engageService) {
        this.siiToolkitService = siiToolkitService;
        this.delegationService = delegationService;
        this.router = router;
        this.sdacPreviewService = sdacPreviewService;
        this.engageService = engageService;
    }
    ngOnInit() {
        // this.photoURL = `${this.siiToolkitService.environment.domain}/sii_common/photo.jpg?${(new Date()).getTime()}`;
        this.photoURL = `${this.siiToolkitService.environment.domain}/sii_common/photo.jpg?${btoa(this.siiToolkitService.loggedUser.value.workerId || '')}`;
    }
    doLogout() {
        window.location.href = `${this.siiToolkitService.environment.domain}/sii_common/logout`;
    }
    doDelegation() {
        this.delegationService.openDelegation();
    }
    doDelegationLogout() {
        this.delegationService.logout();
    }
    openSdacTiketsByCode(code) {
        this.sdacPreviewService.openSdacTiketsByCode(code);
    }
    openSdacNotification() {
        this.sdacPreviewService.openSdacType(true);
    }
    openSdacTicket() {
        this.sdacPreviewService.openSdacType(false);
    }
    goToDeadlines() {
        if (this.engageService.engageAvailable) {
            if (this.engageService.isEngage) {
                this.router.navigateByUrl('deadlines');
            }
            else {
                this.openUrlInWindow(this.engageService.engageDomain + '/deadlines');
            }
        }
        else {
            alert('enagage unavailable');
        }
    }
    goToProfile() {
        if (this.engageService.engageAvailable) {
            if (this.engageService.isEngage) {
                this.router.navigateByUrl('profile');
            }
            else {
                this.openUrlInWindow(this.engageService.engageDomain + '/profile');
            }
        }
        else {
            alert('enagage unavailable');
        }
    }
    openUrlInWindow(url) {
        window.open(url, '_blank', `target=_blank,width=4000,height=4000`);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ProfileButtonComponent, deps: [{ token: i1.SiiToolkitService }, { token: i2.DelegationService }, { token: i3.Router }, { token: i4.SdacPreviewService }, { token: i5.SiiEngageService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.2.13", type: ProfileButtonComponent, isStandalone: true, selector: "sii-profile-button", inputs: { mySelf: "mySelf", hideDetail: "hideDetail" }, ngImport: i0, template: "\r\n<button class=\"sii-profile-button__avatar\" mat-mini-fab\r\n  [ngStyle]=\"{'background-image':'url(' + photoURL + ')'}\"\r\n  >\r\n  @if (corporateItCalendarEventsCount!=0) {\r\n    <span class=\"notificationCount\"> {{corporateItCalendarEventsCount}}</span>\r\n  }\r\n  @if (sdacTicketCount!=0 || sdacNotificationCount!=0) {\r\n    <span    class=\"notificationCountSdac\">{{sdacTicketCount+sdacNotificationCount}}</span>\r\n  }\r\n</button>\r\n@if (!hideDetail) {\r\n  <div class=\"profButtDetailBox\">\r\n    <div class=\"profButtDetailBox_spacer\"></div>\r\n    <div class=\"profButtDetail_container\">\r\n      <div class=\"profile\">\r\n        <p   class=\"text-uppercase name\"><b>{{mySelf?.firstName}} {{mySelf?.lastName}}</b></p>\r\n        <!-- Dettagli utente -->\r\n        <dl class=\"eng-user-details \">\r\n          <dt i18n=\"@@toolbar_workerId\">Worker ID</dt>\r\n          <dd>{{mySelf?.workerId}}</dd>\r\n          <dt><abbr i18n-title=\"@@toolbar_cc\" title=\"Competence Center\" i18n=\"@@toolbar_cc_dim\">CC</abbr></dt>\r\n          <dd><abbr  [title]=\"mySelf.costCenterDescr\" >{{mySelf?.costCenterId}}</abbr></dd>\r\n          <!-- <dd [matTooltip]=\"mySelf.costCenterDescr\">{{mySelf?.costCenterId}}</dd> -->\r\n          <dt i18n=\"@@toolbar_manager\">Manager</dt>\r\n          <dd>{{mySelf.costCenterResp?.firstName}} {{mySelf.costCenterResp?.lastName}}</dd>\r\n          @if (!!mySelf.tutorWorkerId) {\r\n            <dt i18n=\"@@toolbar_tutor\">Tutor</dt>\r\n            <dd>{{mySelf.tutorFistName}} {{mySelf.tutorLastName}}</dd>\r\n          }\r\n          @if (!!mySelf.evaluatorWorkerId) {\r\n            <dt i18n=\"@@toolbar_evaluator\">Evaluator</dt>\r\n            <dd>{{mySelf.evaluatorFistName}} {{mySelf.evaluatorLastName}}</dd>\r\n          }\r\n        </dl>\r\n        <ul class=\"list-unstyled user-actions\">\r\n          <li><a (click)=\"goToProfile()\" tabindex=\"0\" title=\"\" class=\"\"><b i18n=\"@@navbar_goToProfile\">Go To Profile</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a href=\"https://password.eng.it/\" target=\"_blank\" title=\"\" class=\"\"><b i18n=\"@@navbar_changePassford\">Change Password</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a href=\"https://mysignins.microsoft.com/security-info\" target=\"_blank\" title=\"\" class=\"\"><b i18n=\"@@navbar_mfaSettings\">MFA Settings</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a  (click)=\"doLogout()\" tabindex=\"0\" title=\"\" class=\"\"><b i18n=\"@@navbar_logout\">Logout</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <br><br>\r\n          @if (!!mySelf.delegatedUsers) {\r\n            <li (click)=\"doDelegation()\" ><a       title=\"\" class=\"\"><b i18n=\"@@DelegateLogin\">Login as delegated</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          }\r\n          @if (!!mySelf.isInDelegation) {\r\n            <li (click)=\"doDelegationLogout()\"><a  title=\"\" class=\"\"><b ii18n=\"@@DelegateLogout\">Logout from delegation</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          }\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n\r\n", styles: [":host{margin:auto 10px 10px 0;z-index:1}.sii-profile-button__avatar,.sii-profile-button__menu_avatar{background-size:cover;outline:none}.sii-profile-button__avatar{width:40px;height:40px}.sii-profile-button__menu_avatar{margin-right:10px;width:48px;height:48px;border:2px solid white;box-shadow:none}::ng-deep .sii-profile-button__menu{width:260px;max-width:100vw!important;padding:20px 0 20px 23px}::ng-deep .sii-profile-button__menu .mat-mdc-menu-content{padding:0!important}.sii-profile-button__menu_toolbar{display:flex;flex-direction:row}.sii-profile-button__menu_toolbar_right{display:flex;flex-direction:column}.sii-profile-button__menu_toolbar_name{font-size:18px;line-height:20px}.sii-profile-button__menu_goto_profile{color:#0073b1;font-size:12px;cursor:pointer}.sii-profile-button__menu_userInfo{padding-top:20px}.sii-profile-button__menu_actions>div{display:flex;align-items:center;height:45px;cursor:pointer}.sii-profile-button__menu_actions>div mat-icon{padding-right:10px}.sii-profile-button__menu_category_divider{font-size:14px;font-weight:700;background-color:#f3f6f8;line-height:28px;padding:0 6px;border-top:1px solid lightgray;border-bottom:1px solid lightgray;color:gray}.profButtDetailBox{display:none;max-height:calc(100vh - 62px);flex-direction:column;width:350px;max-width:100vw;position:absolute;right:0}.profButtDetailBox .profButtDetailBox_spacer{min-height:10px}.profButtDetailBox .profButtDetail_container{padding:30px;overflow:auto;box-sizing:border-box;background-color:#09090917;-webkit-backdrop-filter:blur(12px) brightness(.75);backdrop-filter:blur(12px) brightness(.75)}.profButtDetailBox .profButtDetail_container .name{font-size:16px}:host:hover .profButtDetailBox{display:flex}.text-uppercase{text-transform:uppercase}.list-unstyled{padding-left:0;list-style:none}.eng-user-details{margin-top:1rem;display:flex;flex-wrap:wrap}.eng-user-details dt{font-weight:700;text-transform:uppercase;font-size:.65rem;flex:0 0 42%;max-width:42%}.eng-user-details dd{text-transform:none;flex:0 0 58%;max-width:58%;margin-bottom:.5rem;margin-left:0}.user-actions li a{display:flex;align-items:center;padding:.33rem;padding-left:0;font-size:1.16em;color:#fff;outline:none;text-decoration:none;cursor:pointer}.notificationCount{background-color:#c51b88;top:-25px;display:none}.notificationCountSdac{background-color:#918d8d;bottom:-25px;display:none}.notificationCount,.notificationCountSdac{padding:2px 2px 1px;border-radius:10rem;color:#fff;position:absolute;line-height:15px;font-size:10px;letter-spacing:1.1px;left:9px;min-width:17px}@media screen and (max-width: 1050px){.notificationCountSdac,.notificationCount{display:block}}@media screen and (min-width: 576px){.profButtDetail_content{width:540px}}@media screen and (min-width: 768px){.profButtDetail_content{width:720px}}@media screen and (min-width: 992px){.profButtDetail_content{width:960px}}@media screen and (min-width: 1200px){.profButtDetail_content{width:1140px}}@media screen and (min-width: 1440px){.profButtDetail_content{width:1320px}}@media screen and (min-width: 1600px){.profButtDetail_content{width:1450px}}@media screen and (min-width: 1920px){.profButtDetail_content{width:1610px}}\n"], dependencies: [{ kind: "component", type: MatMiniFabButton, selector: "button[mat-mini-fab]", exportAs: ["matButton"] }, { kind: "directive", type: NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: ProfileButtonComponent, decorators: [{
            type: Component,
            args: [{ selector: 'sii-profile-button', standalone: true, imports: [MatMiniFabButton, NgStyle, MatIcon], template: "\r\n<button class=\"sii-profile-button__avatar\" mat-mini-fab\r\n  [ngStyle]=\"{'background-image':'url(' + photoURL + ')'}\"\r\n  >\r\n  @if (corporateItCalendarEventsCount!=0) {\r\n    <span class=\"notificationCount\"> {{corporateItCalendarEventsCount}}</span>\r\n  }\r\n  @if (sdacTicketCount!=0 || sdacNotificationCount!=0) {\r\n    <span    class=\"notificationCountSdac\">{{sdacTicketCount+sdacNotificationCount}}</span>\r\n  }\r\n</button>\r\n@if (!hideDetail) {\r\n  <div class=\"profButtDetailBox\">\r\n    <div class=\"profButtDetailBox_spacer\"></div>\r\n    <div class=\"profButtDetail_container\">\r\n      <div class=\"profile\">\r\n        <p   class=\"text-uppercase name\"><b>{{mySelf?.firstName}} {{mySelf?.lastName}}</b></p>\r\n        <!-- Dettagli utente -->\r\n        <dl class=\"eng-user-details \">\r\n          <dt i18n=\"@@toolbar_workerId\">Worker ID</dt>\r\n          <dd>{{mySelf?.workerId}}</dd>\r\n          <dt><abbr i18n-title=\"@@toolbar_cc\" title=\"Competence Center\" i18n=\"@@toolbar_cc_dim\">CC</abbr></dt>\r\n          <dd><abbr  [title]=\"mySelf.costCenterDescr\" >{{mySelf?.costCenterId}}</abbr></dd>\r\n          <!-- <dd [matTooltip]=\"mySelf.costCenterDescr\">{{mySelf?.costCenterId}}</dd> -->\r\n          <dt i18n=\"@@toolbar_manager\">Manager</dt>\r\n          <dd>{{mySelf.costCenterResp?.firstName}} {{mySelf.costCenterResp?.lastName}}</dd>\r\n          @if (!!mySelf.tutorWorkerId) {\r\n            <dt i18n=\"@@toolbar_tutor\">Tutor</dt>\r\n            <dd>{{mySelf.tutorFistName}} {{mySelf.tutorLastName}}</dd>\r\n          }\r\n          @if (!!mySelf.evaluatorWorkerId) {\r\n            <dt i18n=\"@@toolbar_evaluator\">Evaluator</dt>\r\n            <dd>{{mySelf.evaluatorFistName}} {{mySelf.evaluatorLastName}}</dd>\r\n          }\r\n        </dl>\r\n        <ul class=\"list-unstyled user-actions\">\r\n          <li><a (click)=\"goToProfile()\" tabindex=\"0\" title=\"\" class=\"\"><b i18n=\"@@navbar_goToProfile\">Go To Profile</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a href=\"https://password.eng.it/\" target=\"_blank\" title=\"\" class=\"\"><b i18n=\"@@navbar_changePassford\">Change Password</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a href=\"https://mysignins.microsoft.com/security-info\" target=\"_blank\" title=\"\" class=\"\"><b i18n=\"@@navbar_mfaSettings\">MFA Settings</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <li><a  (click)=\"doLogout()\" tabindex=\"0\" title=\"\" class=\"\"><b i18n=\"@@navbar_logout\">Logout</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          <br><br>\r\n          @if (!!mySelf.delegatedUsers) {\r\n            <li (click)=\"doDelegation()\" ><a       title=\"\" class=\"\"><b i18n=\"@@DelegateLogin\">Login as delegated</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          }\r\n          @if (!!mySelf.isInDelegation) {\r\n            <li (click)=\"doDelegationLogout()\"><a  title=\"\" class=\"\"><b ii18n=\"@@DelegateLogout\">Logout from delegation</b> <mat-icon>navigate_next</mat-icon></a></li>\r\n          }\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n\r\n", styles: [":host{margin:auto 10px 10px 0;z-index:1}.sii-profile-button__avatar,.sii-profile-button__menu_avatar{background-size:cover;outline:none}.sii-profile-button__avatar{width:40px;height:40px}.sii-profile-button__menu_avatar{margin-right:10px;width:48px;height:48px;border:2px solid white;box-shadow:none}::ng-deep .sii-profile-button__menu{width:260px;max-width:100vw!important;padding:20px 0 20px 23px}::ng-deep .sii-profile-button__menu .mat-mdc-menu-content{padding:0!important}.sii-profile-button__menu_toolbar{display:flex;flex-direction:row}.sii-profile-button__menu_toolbar_right{display:flex;flex-direction:column}.sii-profile-button__menu_toolbar_name{font-size:18px;line-height:20px}.sii-profile-button__menu_goto_profile{color:#0073b1;font-size:12px;cursor:pointer}.sii-profile-button__menu_userInfo{padding-top:20px}.sii-profile-button__menu_actions>div{display:flex;align-items:center;height:45px;cursor:pointer}.sii-profile-button__menu_actions>div mat-icon{padding-right:10px}.sii-profile-button__menu_category_divider{font-size:14px;font-weight:700;background-color:#f3f6f8;line-height:28px;padding:0 6px;border-top:1px solid lightgray;border-bottom:1px solid lightgray;color:gray}.profButtDetailBox{display:none;max-height:calc(100vh - 62px);flex-direction:column;width:350px;max-width:100vw;position:absolute;right:0}.profButtDetailBox .profButtDetailBox_spacer{min-height:10px}.profButtDetailBox .profButtDetail_container{padding:30px;overflow:auto;box-sizing:border-box;background-color:#09090917;-webkit-backdrop-filter:blur(12px) brightness(.75);backdrop-filter:blur(12px) brightness(.75)}.profButtDetailBox .profButtDetail_container .name{font-size:16px}:host:hover .profButtDetailBox{display:flex}.text-uppercase{text-transform:uppercase}.list-unstyled{padding-left:0;list-style:none}.eng-user-details{margin-top:1rem;display:flex;flex-wrap:wrap}.eng-user-details dt{font-weight:700;text-transform:uppercase;font-size:.65rem;flex:0 0 42%;max-width:42%}.eng-user-details dd{text-transform:none;flex:0 0 58%;max-width:58%;margin-bottom:.5rem;margin-left:0}.user-actions li a{display:flex;align-items:center;padding:.33rem;padding-left:0;font-size:1.16em;color:#fff;outline:none;text-decoration:none;cursor:pointer}.notificationCount{background-color:#c51b88;top:-25px;display:none}.notificationCountSdac{background-color:#918d8d;bottom:-25px;display:none}.notificationCount,.notificationCountSdac{padding:2px 2px 1px;border-radius:10rem;color:#fff;position:absolute;line-height:15px;font-size:10px;letter-spacing:1.1px;left:9px;min-width:17px}@media screen and (max-width: 1050px){.notificationCountSdac,.notificationCount{display:block}}@media screen and (min-width: 576px){.profButtDetail_content{width:540px}}@media screen and (min-width: 768px){.profButtDetail_content{width:720px}}@media screen and (min-width: 992px){.profButtDetail_content{width:960px}}@media screen and (min-width: 1200px){.profButtDetail_content{width:1140px}}@media screen and (min-width: 1440px){.profButtDetail_content{width:1320px}}@media screen and (min-width: 1600px){.profButtDetail_content{width:1450px}}@media screen and (min-width: 1920px){.profButtDetail_content{width:1610px}}\n"] }]
        }], ctorParameters: () => [{ type: i1.SiiToolkitService }, { type: i2.DelegationService }, { type: i3.Router }, { type: i4.SdacPreviewService }, { type: i5.SiiEngageService }], propDecorators: { mySelf: [{
                type: Input
            }], hideDetail: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZmlsZS1idXR0b24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2lpLXRvb2xraXQvc3JjL2xpYi9jb21wb25lbnRzL3Byb2ZpbGUtYnV0dG9uL3Byb2ZpbGUtYnV0dG9uLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NpaS10b29sa2l0L3NyYy9saWIvY29tcG9uZW50cy9wcm9maWxlLWJ1dHRvbi9wcm9maWxlLWJ1dHRvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU96RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDakQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDOzs7Ozs7O0FBUzVELE1BQU0sT0FBTyxzQkFBc0I7SUFJakMsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztJQUM3QyxDQUFDO0lBQ0QsSUFBSSxxQkFBcUI7UUFDdkIsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLENBQUM7SUFDbkQsQ0FBQztJQUNELElBQUksOEJBQThCO1FBQ2hDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBQztJQUN6RCxDQUFDO0lBS0QsWUFBbUIsaUJBQW9DLEVBQVMsaUJBQW9DLEVBQVUsTUFBYyxFQUN4RyxrQkFBc0MsRUFBVSxhQUErQjtRQURoRixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQVMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDeEcsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFrQjtJQUFJLENBQUM7SUFFeEcsUUFBUTtRQUNOLGlIQUFpSDtRQUNqSCxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxNQUFNLHlCQUF5QixJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUM7SUFDdEosQ0FBQztJQUVELFFBQVE7UUFDTCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsTUFBTSxvQkFBb0IsQ0FBQztJQUMzRixDQUFDO0lBQ0QsWUFBWTtRQUNYLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN6QyxDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBR0Qsb0JBQW9CLENBQUMsSUFBSztRQUN4QixJQUFJLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVELG9CQUFvQjtRQUNsQixJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFDRCxjQUFjO1FBQ1osSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsYUFBYTtRQUNYLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUMsQ0FBQztZQUN0QyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFDLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3pDLENBQUM7aUJBQUksQ0FBQztnQkFDSixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBRSxDQUFDO1lBQ3hFLENBQUM7UUFDSCxDQUFDO2FBQUksQ0FBQztZQUNKLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQy9CLENBQUM7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUMsQ0FBQztZQUN0QyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFDLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3ZDLENBQUM7aUJBQUksQ0FBQztnQkFDTixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQyxDQUFDO1lBQ25FLENBQUM7UUFDSCxDQUFDO2FBQUksQ0FBQztZQUNKLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQy9CLENBQUM7SUFDSCxDQUFDO0lBRUQsZUFBZSxDQUFDLEdBQVU7UUFDeEIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUMsUUFBUSxFQUFDLHNDQUFzQyxDQUFDLENBQUE7SUFDbEUsQ0FBQzsrR0ExRVUsc0JBQXNCO21HQUF0QixzQkFBc0Isc0lDbEJuQyxtbUdBcURBLDBxR0RyQ2MsZ0JBQWdCLDBGQUFFLE9BQU8sMkVBQUUsT0FBTzs7NEZBRW5DLHNCQUFzQjtrQkFQbEMsU0FBUzsrQkFDSSxvQkFBb0IsY0FHbEIsSUFBSSxXQUNQLENBQUMsZ0JBQWdCLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQzsyTUFHdEMsTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU2lpVG9vbGtpdFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zaWktdG9vbGtpdC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTXlzZWxmRFRPIH0gZnJvbSAnLi4vLi4vZHRvL215c2VsZi5kdG8nO1xyXG5pbXBvcnQgeyBTZGFjUHJldmlld1NlcnZpY2UgfSBmcm9tICcuLi9kc2lpLWNvbXBvbmVudHMvc2RhYy1wcmV2aWV3L3NlcnZpY2Uvc2RhYy1wcmV2aWV3LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTaWlFbmdhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9zaWktZW5nYWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBEZWxlZ2F0aW9uU2VydmljZSB9IGZyb20gJy4uL2RzaWktY29tcG9uZW50cy9kZWxlZ2F0aW9uL2RlbGVnYXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IE1hdEljb24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9pY29uJztcclxuaW1wb3J0IHsgTmdTdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IE1hdE1pbmlGYWJCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3NpaS1wcm9maWxlLWJ1dHRvbicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcHJvZmlsZS1idXR0b24uY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJy4vcHJvZmlsZS1idXR0b24uY29tcG9uZW50LnNjc3MnXSxcclxuICAgIHN0YW5kYWxvbmU6IHRydWUsXHJcbiAgICBpbXBvcnRzOiBbTWF0TWluaUZhYkJ1dHRvbiwgTmdTdHlsZSwgTWF0SWNvbl1cclxufSlcclxuZXhwb3J0IGNsYXNzIFByb2ZpbGVCdXR0b25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBJbnB1dCgpIG15U2VsZjogTXlzZWxmRFRPO1xyXG4gIEBJbnB1dCgpIGhpZGVEZXRhaWw6IGJvb2xlYW47XHJcblxyXG4gIGdldCBzZGFjVGlja2V0Q291bnQoKXtcclxuICAgIHJldHVybiB0aGlzLnNkYWNQcmV2aWV3U2VydmljZS50aWNrZXRDb3VudDtcclxuICB9XHJcbiAgZ2V0IHNkYWNOb3RpZmljYXRpb25Db3VudCgpe1xyXG4gICAgcmV0dXJuIHRoaXMuc2RhY1ByZXZpZXdTZXJ2aWNlLm5vdGlmaWNhdGlvbkNvdW50O1xyXG4gIH1cclxuICBnZXQgY29ycG9yYXRlSXRDYWxlbmRhckV2ZW50c0NvdW50KCl7XHJcbiAgICByZXR1cm4gdGhpcy5lbmdhZ2VTZXJ2aWNlLmNvcnBvcmF0ZUNhbGVuZGFyRXZlbnRzQ291bnQ7XHJcbiAgfVxyXG5cclxuXHJcbiAgcGhvdG9VUkw6IHN0cmluZyA7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzaWlUb29sa2l0U2VydmljZTogU2lpVG9vbGtpdFNlcnZpY2UsIHB1YmxpYyBkZWxlZ2F0aW9uU2VydmljZTogRGVsZWdhdGlvblNlcnZpY2UsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBzZGFjUHJldmlld1NlcnZpY2U6IFNkYWNQcmV2aWV3U2VydmljZSwgcHJpdmF0ZSBlbmdhZ2VTZXJ2aWNlOiBTaWlFbmdhZ2VTZXJ2aWNlKSB7IH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAvLyB0aGlzLnBob3RvVVJMID0gYCR7dGhpcy5zaWlUb29sa2l0U2VydmljZS5lbnZpcm9ubWVudC5kb21haW59L3NpaV9jb21tb24vcGhvdG8uanBnPyR7KG5ldyBEYXRlKCkpLmdldFRpbWUoKX1gO1xyXG4gICAgdGhpcy5waG90b1VSTCA9IGAke3RoaXMuc2lpVG9vbGtpdFNlcnZpY2UuZW52aXJvbm1lbnQuZG9tYWlufS9zaWlfY29tbW9uL3Bob3RvLmpwZz8ke2J0b2EodGhpcy5zaWlUb29sa2l0U2VydmljZS5sb2dnZWRVc2VyLnZhbHVlLndvcmtlcklkIHx8ICcnKX1gO1xyXG4gIH1cclxuXHJcbiAgZG9Mb2dvdXQoKSB7XHJcbiAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgJHt0aGlzLnNpaVRvb2xraXRTZXJ2aWNlLmVudmlyb25tZW50LmRvbWFpbn0vc2lpX2NvbW1vbi9sb2dvdXRgO1xyXG4gIH1cclxuICBkb0RlbGVnYXRpb24oKSB7XHJcbiAgIHRoaXMuZGVsZWdhdGlvblNlcnZpY2Uub3BlbkRlbGVnYXRpb24oKTtcclxuICB9XHJcblxyXG4gIGRvRGVsZWdhdGlvbkxvZ291dCgpe1xyXG4gICAgdGhpcy5kZWxlZ2F0aW9uU2VydmljZS5sb2dvdXQoKTtcclxuICB9XHJcblxyXG5cclxuICBvcGVuU2RhY1Rpa2V0c0J5Q29kZShjb2RlPyl7XHJcbiAgICB0aGlzLnNkYWNQcmV2aWV3U2VydmljZS5vcGVuU2RhY1Rpa2V0c0J5Q29kZShjb2RlKTtcclxuICB9XHJcblxyXG4gIG9wZW5TZGFjTm90aWZpY2F0aW9uKCl7XHJcbiAgICB0aGlzLnNkYWNQcmV2aWV3U2VydmljZS5vcGVuU2RhY1R5cGUodHJ1ZSk7XHJcbiAgfVxyXG4gIG9wZW5TZGFjVGlja2V0KCl7XHJcbiAgICB0aGlzLnNkYWNQcmV2aWV3U2VydmljZS5vcGVuU2RhY1R5cGUoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgZ29Ub0RlYWRsaW5lcygpe1xyXG4gICAgaWYgKHRoaXMuZW5nYWdlU2VydmljZS5lbmdhZ2VBdmFpbGFibGUpe1xyXG4gICAgICBpZiAodGhpcy5lbmdhZ2VTZXJ2aWNlLmlzRW5nYWdlKXtcclxuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKCdkZWFkbGluZXMnKTtcclxuICAgICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5vcGVuVXJsSW5XaW5kb3codGhpcy5lbmdhZ2VTZXJ2aWNlLmVuZ2FnZURvbWFpbiArICcvZGVhZGxpbmVzJyApO1xyXG4gICAgICB9XHJcbiAgICB9ZWxzZXtcclxuICAgICAgYWxlcnQoJ2VuYWdhZ2UgdW5hdmFpbGFibGUnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdvVG9Qcm9maWxlKCl7XHJcbiAgICBpZiAodGhpcy5lbmdhZ2VTZXJ2aWNlLmVuZ2FnZUF2YWlsYWJsZSl7XHJcbiAgICAgIGlmICh0aGlzLmVuZ2FnZVNlcnZpY2UuaXNFbmdhZ2Upe1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwoJ3Byb2ZpbGUnKTtcclxuICAgICAgfWVsc2V7XHJcbiAgICAgIHRoaXMub3BlblVybEluV2luZG93KHRoaXMuZW5nYWdlU2VydmljZS5lbmdhZ2VEb21haW4gKyAnL3Byb2ZpbGUnKTtcclxuICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgIGFsZXJ0KCdlbmFnYWdlIHVuYXZhaWxhYmxlJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVuVXJsSW5XaW5kb3codXJsOnN0cmluZyl7XHJcbiAgICB3aW5kb3cub3Blbih1cmwsJ19ibGFuaycsYHRhcmdldD1fYmxhbmssd2lkdGg9NDAwMCxoZWlnaHQ9NDAwMGApXHJcbiAgfVxyXG5cclxufVxyXG4iLCJcclxuPGJ1dHRvbiBjbGFzcz1cInNpaS1wcm9maWxlLWJ1dHRvbl9fYXZhdGFyXCIgbWF0LW1pbmktZmFiXHJcbiAgW25nU3R5bGVdPVwieydiYWNrZ3JvdW5kLWltYWdlJzondXJsKCcgKyBwaG90b1VSTCArICcpJ31cIlxyXG4gID5cclxuICBAaWYgKGNvcnBvcmF0ZUl0Q2FsZW5kYXJFdmVudHNDb3VudCE9MCkge1xyXG4gICAgPHNwYW4gY2xhc3M9XCJub3RpZmljYXRpb25Db3VudFwiPiB7e2NvcnBvcmF0ZUl0Q2FsZW5kYXJFdmVudHNDb3VudH19PC9zcGFuPlxyXG4gIH1cclxuICBAaWYgKHNkYWNUaWNrZXRDb3VudCE9MCB8fCBzZGFjTm90aWZpY2F0aW9uQ291bnQhPTApIHtcclxuICAgIDxzcGFuICAgIGNsYXNzPVwibm90aWZpY2F0aW9uQ291bnRTZGFjXCI+e3tzZGFjVGlja2V0Q291bnQrc2RhY05vdGlmaWNhdGlvbkNvdW50fX08L3NwYW4+XHJcbiAgfVxyXG48L2J1dHRvbj5cclxuQGlmICghaGlkZURldGFpbCkge1xyXG4gIDxkaXYgY2xhc3M9XCJwcm9mQnV0dERldGFpbEJveFwiPlxyXG4gICAgPGRpdiBjbGFzcz1cInByb2ZCdXR0RGV0YWlsQm94X3NwYWNlclwiPjwvZGl2PlxyXG4gICAgPGRpdiBjbGFzcz1cInByb2ZCdXR0RGV0YWlsX2NvbnRhaW5lclwiPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwicHJvZmlsZVwiPlxyXG4gICAgICAgIDxwICAgY2xhc3M9XCJ0ZXh0LXVwcGVyY2FzZSBuYW1lXCI+PGI+e3tteVNlbGY/LmZpcnN0TmFtZX19IHt7bXlTZWxmPy5sYXN0TmFtZX19PC9iPjwvcD5cclxuICAgICAgICA8IS0tIERldHRhZ2xpIHV0ZW50ZSAtLT5cclxuICAgICAgICA8ZGwgY2xhc3M9XCJlbmctdXNlci1kZXRhaWxzIFwiPlxyXG4gICAgICAgICAgPGR0IGkxOG49XCJAQHRvb2xiYXJfd29ya2VySWRcIj5Xb3JrZXIgSUQ8L2R0PlxyXG4gICAgICAgICAgPGRkPnt7bXlTZWxmPy53b3JrZXJJZH19PC9kZD5cclxuICAgICAgICAgIDxkdD48YWJiciBpMThuLXRpdGxlPVwiQEB0b29sYmFyX2NjXCIgdGl0bGU9XCJDb21wZXRlbmNlIENlbnRlclwiIGkxOG49XCJAQHRvb2xiYXJfY2NfZGltXCI+Q0M8L2FiYnI+PC9kdD5cclxuICAgICAgICAgIDxkZD48YWJiciAgW3RpdGxlXT1cIm15U2VsZi5jb3N0Q2VudGVyRGVzY3JcIiA+e3tteVNlbGY/LmNvc3RDZW50ZXJJZH19PC9hYmJyPjwvZGQ+XHJcbiAgICAgICAgICA8IS0tIDxkZCBbbWF0VG9vbHRpcF09XCJteVNlbGYuY29zdENlbnRlckRlc2NyXCI+e3tteVNlbGY/LmNvc3RDZW50ZXJJZH19PC9kZD4gLS0+XHJcbiAgICAgICAgICA8ZHQgaTE4bj1cIkBAdG9vbGJhcl9tYW5hZ2VyXCI+TWFuYWdlcjwvZHQ+XHJcbiAgICAgICAgICA8ZGQ+e3tteVNlbGYuY29zdENlbnRlclJlc3A/LmZpcnN0TmFtZX19IHt7bXlTZWxmLmNvc3RDZW50ZXJSZXNwPy5sYXN0TmFtZX19PC9kZD5cclxuICAgICAgICAgIEBpZiAoISFteVNlbGYudHV0b3JXb3JrZXJJZCkge1xyXG4gICAgICAgICAgICA8ZHQgaTE4bj1cIkBAdG9vbGJhcl90dXRvclwiPlR1dG9yPC9kdD5cclxuICAgICAgICAgICAgPGRkPnt7bXlTZWxmLnR1dG9yRmlzdE5hbWV9fSB7e215U2VsZi50dXRvckxhc3ROYW1lfX08L2RkPlxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgQGlmICghIW15U2VsZi5ldmFsdWF0b3JXb3JrZXJJZCkge1xyXG4gICAgICAgICAgICA8ZHQgaTE4bj1cIkBAdG9vbGJhcl9ldmFsdWF0b3JcIj5FdmFsdWF0b3I8L2R0PlxyXG4gICAgICAgICAgICA8ZGQ+e3tteVNlbGYuZXZhbHVhdG9yRmlzdE5hbWV9fSB7e215U2VsZi5ldmFsdWF0b3JMYXN0TmFtZX19PC9kZD5cclxuICAgICAgICAgIH1cclxuICAgICAgICA8L2RsPlxyXG4gICAgICAgIDx1bCBjbGFzcz1cImxpc3QtdW5zdHlsZWQgdXNlci1hY3Rpb25zXCI+XHJcbiAgICAgICAgICA8bGk+PGEgKGNsaWNrKT1cImdvVG9Qcm9maWxlKClcIiB0YWJpbmRleD1cIjBcIiB0aXRsZT1cIlwiIGNsYXNzPVwiXCI+PGIgaTE4bj1cIkBAbmF2YmFyX2dvVG9Qcm9maWxlXCI+R28gVG8gUHJvZmlsZTwvYj4gPG1hdC1pY29uPm5hdmlnYXRlX25leHQ8L21hdC1pY29uPjwvYT48L2xpPlxyXG4gICAgICAgICAgPGxpPjxhIGhyZWY9XCJodHRwczovL3Bhc3N3b3JkLmVuZy5pdC9cIiB0YXJnZXQ9XCJfYmxhbmtcIiB0aXRsZT1cIlwiIGNsYXNzPVwiXCI+PGIgaTE4bj1cIkBAbmF2YmFyX2NoYW5nZVBhc3Nmb3JkXCI+Q2hhbmdlIFBhc3N3b3JkPC9iPiA8bWF0LWljb24+bmF2aWdhdGVfbmV4dDwvbWF0LWljb24+PC9hPjwvbGk+XHJcbiAgICAgICAgICA8bGk+PGEgaHJlZj1cImh0dHBzOi8vbXlzaWduaW5zLm1pY3Jvc29mdC5jb20vc2VjdXJpdHktaW5mb1wiIHRhcmdldD1cIl9ibGFua1wiIHRpdGxlPVwiXCIgY2xhc3M9XCJcIj48YiBpMThuPVwiQEBuYXZiYXJfbWZhU2V0dGluZ3NcIj5NRkEgU2V0dGluZ3M8L2I+IDxtYXQtaWNvbj5uYXZpZ2F0ZV9uZXh0PC9tYXQtaWNvbj48L2E+PC9saT5cclxuICAgICAgICAgIDxsaT48YSAgKGNsaWNrKT1cImRvTG9nb3V0KClcIiB0YWJpbmRleD1cIjBcIiB0aXRsZT1cIlwiIGNsYXNzPVwiXCI+PGIgaTE4bj1cIkBAbmF2YmFyX2xvZ291dFwiPkxvZ291dDwvYj4gPG1hdC1pY29uPm5hdmlnYXRlX25leHQ8L21hdC1pY29uPjwvYT48L2xpPlxyXG4gICAgICAgICAgPGJyPjxicj5cclxuICAgICAgICAgIEBpZiAoISFteVNlbGYuZGVsZWdhdGVkVXNlcnMpIHtcclxuICAgICAgICAgICAgPGxpIChjbGljayk9XCJkb0RlbGVnYXRpb24oKVwiID48YSAgICAgICB0aXRsZT1cIlwiIGNsYXNzPVwiXCI+PGIgaTE4bj1cIkBARGVsZWdhdGVMb2dpblwiPkxvZ2luIGFzIGRlbGVnYXRlZDwvYj4gPG1hdC1pY29uPm5hdmlnYXRlX25leHQ8L21hdC1pY29uPjwvYT48L2xpPlxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgQGlmICghIW15U2VsZi5pc0luRGVsZWdhdGlvbikge1xyXG4gICAgICAgICAgICA8bGkgKGNsaWNrKT1cImRvRGVsZWdhdGlvbkxvZ291dCgpXCI+PGEgIHRpdGxlPVwiXCIgY2xhc3M9XCJcIj48YiBpaTE4bj1cIkBARGVsZWdhdGVMb2dvdXRcIj5Mb2dvdXQgZnJvbSBkZWxlZ2F0aW9uPC9iPiA8bWF0LWljb24+bmF2aWdhdGVfbmV4dDwvbWF0LWljb24+PC9hPjwvbGk+XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgPC91bD5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxufVxyXG5cclxuIl19